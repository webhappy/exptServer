(function(c){"function"===typeof define&&define.amd?define(["../../../../../../opt/local/Library/Frameworks/Python.framework/Versions/2.7/lib/python2"],c):"object"===typeof exports?module.exports=c:c(jQuery)})(function(c){function a(e){var a=e||window.event,b=f.call(arguments,1),h=0,q=0,s=0,u=0;e=c.event.fix(a);e.type="mousewheel";"detail"in a&&(s=-1*a.detail);"wheelDelta"in a&&(s=a.wheelDelta);"wheelDeltaY"in a&&(s=a.wheelDeltaY);"wheelDeltaX"in a&&(q=-1*a.wheelDeltaX);"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&
(q=-1*s,s=0);h=0===s?q:s;"deltaY"in a&&(h=s=-1*a.deltaY);"deltaX"in a&&(q=a.deltaX,0===s&&(h=-1*q));if(0!==s||0!==q){1===a.deltaMode?(u=c.data(this,"mousewheel-line-height"),h*=u,s*=u,q*=u):2===a.deltaMode&&(u=c.data(this,"mousewheel-page-height"),h*=u,s*=u,q*=u);u=Math.max(Math.abs(s),Math.abs(q));if(!g||u<g)g=u,k.settings.adjustOldDeltas&&"mousewheel"===a.type&&0===u%120&&(g/=40);k.settings.adjustOldDeltas&&"mousewheel"===a.type&&0===u%120&&(h/=40,q/=40,s/=40);h=Math[1<=h?"floor":"ceil"](h/g);q=
Math[1<=q?"floor":"ceil"](q/g);s=Math[1<=s?"floor":"ceil"](s/g);e.deltaX=q;e.deltaY=s;e.deltaFactor=g;e.deltaMode=0;b.unshift(e,h,q,s);l&&clearTimeout(l);l=setTimeout(d,200);return(c.event.dispatch||c.event.handle).apply(this,b)}}function d(){g=null}var b=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],e="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],f=Array.prototype.slice,l,g;if(c.event.fixHooks)for(var h=b.length;h;)c.event.fixHooks[b[--h]]=
c.event.mouseHooks;var k=c.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var b=e.length;b;)this.addEventListener(e[--b],a,!1);else this.onmousewheel=a;c.data(this,"mousewheel-line-height",k.getLineHeight(this));c.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var b=e.length;b;)this.removeEventListener(e[--b],a,!1);else this.onmousewheel=null},getLineHeight:function(a){return parseInt(c(a)["offsetParent"in
c.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(a){return c(a).height()},settings:{adjustOldDeltas:!0}};c.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});(function(c){if(c.zepto&&!c.fn.removeData)throw new ReferenceError("Zepto is loaded without the data module.");c.fn.noUiSlider=function(a,d){function b(a,e){return 100*e/(a[1]-a[0])}function e(a,e){return e*(a[1]-a[0])/100+a[0]}function f(a){return a instanceof c||c.zepto&&c.zepto.isZ(a)}function l(a){return!isNaN(parseFloat(a))&&isFinite(a)}function g(a,e){c.isArray(a)||(a=[a]);c.each(a,function(){"function"===typeof this&&this.call(e)})}function h(a,e){return function(){var b=[null,null];b[e]=c(this).val();
a.val(b,!0)}}function k(a,e){a=a.toFixed(e.decimals);0===parseFloat(a)&&(a=a.replace("-0","0"));return a.replace(".",e.serialization.mark)}function m(a,e,b,f){var d=f.target;a=a.replace(/\s/g,L+" ")+L;return e.on(a,function(a){var e=d.attr("disabled"),e=!(void 0===e||null===e);if(d.hasClass("noUi-state-tap")||e)return!1;var l;a.preventDefault();var e=0===a.type.indexOf("touch"),g=0===a.type.indexOf("mouse"),h=0===a.type.indexOf("pointer"),k,m=a;0===a.type.indexOf("MSPointer")&&(h=!0);a.originalEvent&&
(a=a.originalEvent);e&&(l=a.changedTouches[0].pageX,k=a.changedTouches[0].pageY);if(g||h)h||void 0!==window.pageXOffset||(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),l=a.clientX+window.pageXOffset,k=a.clientY+window.pageYOffset;l=c.extend(m,{pointX:l,pointY:k,cursor:g});b(l,f,d.data("base").data("options"))})}function p(a){var e=this.target;if(void 0===a)return this.element.data("value");!0===a?a=this.element.data("value"):this.element.data("value",
a);void 0!==a&&c.each(this.elements,function(){if("function"===typeof this)this.call(e,a);else this[0][this[1]](a)})}function r(a,e,b){if(f(e)){var d=[],l=a.data("target");a.data("options").direction&&(b=b?0:1);e.each(function(){c(this).on("change"+L,h(l,b));d.push([c(this),"val"])});return d}"string"===typeof e&&(e=[c('<input type="hidden" name="'+e+'">').appendTo(a).addClass(B[3]).change(function(a){a.stopPropagation()}),"val"]);return[e]}function n(a,e,b){var f=[];c.each(b.to[e],function(d){f=
f.concat(r(a,b.to[e][d],e))});return{element:a,elements:f,target:a.data("target"),val:p}}function q(a,e){var b=a.data("target");b.hasClass(B[14])||(e||(b.addClass(B[15]),setTimeout(function(){b.removeClass(B[15])},450)),b.addClass(B[14]),g(a.data("options").block,b))}function s(a,b){var f=a.data("options");b=parseFloat(b.toFixed(7));a.data("target").removeClass(B[14]);a.css(f.style,b+"%").data("pct",b);a.is(":first-child")&&a.toggleClass(B[13],50<b);f.direction&&(b=100-b);a.data("store").val(k(e(f.range,
b),f))}function u(a,e){var b=a.data("base"),f=b.data("options"),d=b.data("handles"),b=0,c=100;if(!l(e))return!1;if(f.step){var g=f.step;e=Math.round(e/g)*g}1<d.length&&(a[0]!==d[0][0]?(f=d[0].data("pct")+f.margin,b=parseFloat(f.toFixed(7))):(f=d[1].data("pct")-f.margin,c=parseFloat(f.toFixed(7))));e=Math.min(Math.max(e,b),0>c?100:c);if(e===a.data("pct"))return[b?b:!1,100===c?!1:c];s(a,e);return!0}function w(a,e,b,f){a.addClass(B[5]);setTimeout(function(){a.removeClass(B[5])},300);u(e,b);g(f,a.data("target"));
a.data("target").change()}function z(a,e,b){var f=e.handles,d=a[e.point]-e.start[e.point],d=100*d/e.size;if(1===f.length){if(a=u(f[0],e.positions[0]+d),!0!==a){0<=c.inArray(f[0].data("pct"),a)&&q(e.base,!b.margin);return}}else{var l,h;b.step&&(a=b.step,d=Math.round(d/a)*a);a=l=e.positions[0]+d;d=h=e.positions[1]+d;0>a?(d+=-1*a,a=0):100<d&&(a-=d-100,d=100);if(0>l&&!a&&!f[0].data("pct")||100===d&&100<h&&100===f[1].data("pct"))return;s(f[0],a);s(f[1],d)}g(b.slide,e.target)}function v(a,e,b){1===e.handles.length&&
e.handles[0].data("grab").removeClass(B[4]);a.cursor&&M.css("cursor","").off(L);F.off(L);e.target.removeClass(B[14]+" "+B[20]).change();g(b.set,e.target)}function x(a,e,b){1===e.handles.length&&e.handles[0].data("grab").addClass(B[4]);a.stopPropagation();m(N.move,F,z,{start:a,base:e.base,target:e.target,handles:e.handles,positions:[e.handles[0].data("pct"),e.handles[e.handles.length-1].data("pct")],point:b.orientation?"pointY":"pointX",size:b.orientation?e.base.height():e.base.width()});m(N.end,F,
v,{target:e.target,handles:e.handles});a.cursor&&(M.css("cursor",c(a.target).css("cursor")),1<e.handles.length&&e.target.addClass(B[20]),M.on("selectstart"+L,function(){return!1}))}function y(a,e,b){e=e.base;var f,d;a.stopPropagation();b.orientation?(a=a.pointY,d=e.height()):(a=a.pointX,d=e.width());f=e.data("handles");var c=a,l=b.style;1===f.length?f=f[0]:(l=f[0].offset()[l]+f[1].offset()[l],f=f[c<l/2?0:1]);a=100*(a-e.offset()[b.style])/d;w(e,f,a,[b.slide,b.set])}function G(a,e,b){var f=e.base.data("handles"),
d;d=b.orientation?a.pointY:a.pointX;a=(d=d<e.base.offset()[b.style])?0:100;d=d?0:f.length-1;w(e.base,f[d],a,[b.slide,b.set])}function A(a,e){function d(a){if(2!==a.length)return!1;a=[parseFloat(a[0]),parseFloat(a[1])];return!l(a[0])||!l(a[1])||a[1]<a[0]?!1:a}var g={resolution:function(a,e){switch(a){case 1:case 0.1:case 0.01:case 0.001:case 1E-4:case 1E-5:a=a.toString().split(".");e.decimals="1"===a[0]?0:a[1].length;break;case void 0:e.decimals=2;break;default:return!1}return!0},mark:function(a,e,
b){if(!a)return e[b].mark=".",!0;switch(a){case ".":case ",":return!0;default:return!1}},to:function(a,e,b){function d(a){return f(a)||"string"===typeof a||"function"===typeof a||!1===a||f(a[0])&&"function"===typeof a[0][a[1]]}function l(a){var e=[[],[]];d(a)?e[0].push(a):c.each(a,function(a,b){1<a||(d(b)?e[a].push(b):e[a]=e[a].concat(b))});return e}if(a){var g,h;a=l(a);e.direction&&a[1].length&&a.reverse();for(g=0;g<e.handles;g++)for(h=0;h<a[g].length;h++){if(!d(a[g][h]))return!1;a[g][h]||a[g].splice(h,
1)}e[b].to=a}else e[b].to=[[],[]];return!0}};c.each({handles:{r:!0,t:function(a){a=parseInt(a,10);return 1===a||2===a}},range:{r:!0,t:function(a,e,b){e[b]=d(a);return e[b]&&e[b][0]!==e[b][1]}},start:{r:!0,t:function(a,e,b){if(1===e.handles)return c.isArray(a)&&(a=a[0]),a=parseFloat(a),e.start=[a],l(a);e[b]=d(a);return!!e[b]}},connect:{r:!0,t:function(a,e,b){if("lower"===a)e[b]=1;else if("upper"===a)e[b]=2;else if(!0===a)e[b]=3;else if(!1===a)e[b]=0;else return!1;return!0}},orientation:{t:function(a,
e,b){switch(a){case "horizontal":e[b]=0;break;case "vertical":e[b]=1;break;default:return!1}return!0}},margin:{r:!0,t:function(a,e,f){a=parseFloat(a);e[f]=b(e.range,a);return l(a)}},direction:{r:!0,t:function(a,e,b){switch(a){case "ltr":e[b]=0;break;case "rtl":e[b]=1;e.connect=[0,2,1,3][e.connect];break;default:return!1}return!0}},behaviour:{r:!0,t:function(a,e,b){e[b]={tap:a!==(a=a.replace("tap","")),extend:a!==(a=a.replace("extend","")),drag:a!==(a=a.replace("drag","")),fixed:a!==(a=a.replace("fixed",
""))};return!a.replace("none","").replace(/\-/g,"")}},serialization:{r:!0,t:function(a,e,b){return g.to(a.to,e,b)&&g.resolution(a.resolution,e)&&g.mark(a.mark,e,b)}},slide:{t:function(a){return c.isFunction(a)}},set:{t:function(a){return c.isFunction(a)}},block:{t:function(a){return c.isFunction(a)}},step:{t:function(a,e,f){a=parseFloat(a);e[f]=b(e.range,a);return l(a)}}},function(b,f){var d=a[b],c=void 0!==d;if(f.r&&!c||c&&!f.t(d,a,b))throw console&&console.log&&console.group&&(console.group("Invalid noUiSlider initialisation:"),
console.log("Option:\t",b),console.log("Value:\t",d),console.log("Slider(s):\t",e),console.groupEnd()),new RangeError("noUiSlider");})}function E(a){this.data("options",c.extend(!0,{},a));a=c.extend({handles:2,margin:0,connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal"},a);a.serialization=a.serialization||{};A(a,this);a.style=a.orientation?"top":"left";return this.each(function(){var e=c(this),b,f=[],d,l=c("<div/>").appendTo(e);if(e.data("base"))throw Error("Slider was already initialized.");
e.data("base",l).addClass([B[6],B[16+a.direction],B[10+a.orientation]].join(" "));for(b=0;b<a.handles;b++)d=c("<div><div/></div>").appendTo(l),d.addClass(B[1]),d.children().addClass([B[2],B[2]+B[7+a.direction+(a.direction?-1*b:b)]].join(" ")),d.data({base:l,target:e,options:a,grab:d.children(),pct:-1}).attr("data-style",a.style),d.data({store:n(d,b,a.serialization)}),f.push(d);switch(a.connect){case 1:e.addClass(B[9]);f[0].addClass(B[12]);break;case 3:f[1].addClass(B[12]);case 2:f[0].addClass(B[9]);
case 0:e.addClass(B[12])}l.addClass(B[0]).data({target:e,options:a,handles:f});e.val(a.start);if(!a.behaviour.fixed)for(b=0;b<f.length;b++)m(N.start,f[b].children(),x,{base:l,target:e,handles:[f[b]]});a.behaviour.tap&&m(N.start,l,y,{base:l,target:e});a.behaviour.extend&&(e.addClass(B[19]),a.behaviour.tap&&m(N.start,e,G,{base:l,target:e}));a.behaviour.drag&&(b=l.find("."+B[9]).addClass(B[18]),a.behaviour.fixed&&(b=b.add(l.children().not(b).data("grab"))),m(N.start,b,x,{base:l,target:e,handles:f}))})}
function I(){var a=c(this).data("base"),e=[];c.each(a.data("handles"),function(){e.push(c(this).data("store").val())});return 1===e.length?e[0]:a.data("options").direction?e.reverse():e}function K(a,e){c.isArray(a)||(a=[a]);return this.each(function(){var f=c(this).data("base"),d,l=Array.prototype.slice.call(f.data("handles"),0),h=f.data("options");1<l.length&&(l[2]=l[0]);h.direction&&a.reverse();for(f=0;f<l.length;f++)if(d=a[f%2],null!==d&&void 0!==d){"string"===c.type(d)&&(d=d.replace(",","."));
var k=h.range;d=parseFloat(d);d=b(k,0>k[0]?d+Math.abs(k[0]):d-k[0]);h.direction&&(d=100-d);!0!==u(l[f],d)&&l[f].data("store").val(!0);!0===e&&g(h.set,c(this))}})}function J(a){var e=[[a,""]];c.each(a.data("base").data("handles"),function(){e=e.concat(c(this).data("store").elements)});c.each(e,function(){1<this.length&&this[0].off(L)});a.removeClass(B.join(" "));a.empty().removeData("base options")}function C(a){return this.each(function(){var e=c(this).val()||!1,b=c(this).data("options"),f=c.extend({},
b,a);!1!==e&&J(c(this));a&&(c(this).noUiSlider(f),!1!==e&&f.start===b.start&&c(this).val(e))})}var F=c(document),M=c("body"),L=".nui",D=c.fn.val,B="noUi-base noUi-origin noUi-handle noUi-input noUi-active noUi-state-tap noUi-target -lower -upper noUi-connect noUi-horizontal noUi-vertical noUi-background noUi-stacking noUi-block noUi-state-blocked noUi-ltr noUi-rtl noUi-dragable noUi-extended noUi-state-drag".split(" "),N=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:
window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"};c.fn.val=function(){return this.hasClass(B[6])?arguments.length?K.apply(this,arguments):I.apply(this):D.apply(this,arguments)};return(d?C:E).call(this,a)}})(window.jQuery||window.Zepto);/*
 MPL v1.1 [http://www.pixastic.com/lib/license.txt]
*/
var Kinetic={};
(function(){Kinetic={version:"5.0.1",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,UA:function(){var c=navigator.userAgent.toLowerCase(),c=/(chrome)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||0>c.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(c)||[];return{browser:c[1]||"",version:c[2]||"0"}}(),
Filters:{},Node:function(c){this._init(c)},Shape:function(c){this.__init(c)},Container:function(c){this.__init(c)},Stage:function(c){this.___init(c)},Layer:function(c){this.___init(c)},Group:function(c){this.___init(c)},isDragging:function(){var c=Kinetic.DD;return c?c.isDragging:!1},isDragReady:function(){var c=Kinetic.DD;return c?!!c.node:!1},_addId:function(c,a){void 0!==a&&(this.ids[a]=c)},_removeId:function(c){void 0!==c&&delete this.ids[c]},_addName:function(c,a){void 0!==a&&(void 0===this.names[a]&&
(this.names[a]=[]),this.names[a].push(c))},_removeName:function(c,a){if(void 0!==c){var d=this.names[c];if(void 0!==d){for(var b=0;b<d.length;b++)d[b]._id===a&&d.splice(b,1);0===d.length&&delete this.names[c]}}}}})();(function(c,a){"object"===typeof exports?module.exports=a():"function"===typeof define&&define.amd?define(a):c.returnExports=a()})(this,function(){return Kinetic});
(function(){Kinetic.Collection=function(){var a=[].slice.call(arguments),b=a.length,d=0;for(this.length=b;d<b;d++)this[d]=a[d];return this};Kinetic.Collection.prototype=[];Kinetic.Collection.prototype.each=function(a){for(var b=0;b<this.length;b++)a(this[b],b)};Kinetic.Collection.prototype.toArray=function(){var a=[],b=this.length,d;for(d=0;d<b;d++)a.push(this[d]);return a};Kinetic.Collection.toCollection=function(a){var b=new Kinetic.Collection,d=a.length,c;for(c=0;c<d;c++)b.push(a[c]);return b};
Kinetic.Collection.mapMethods=function(a){a=a.prototype;for(var b in a)(function(a){Kinetic.Collection.prototype[a]=function(){var e=this.length,b;args=[].slice.call(arguments);for(b=0;b<e;b++)this[b][a].apply(this[b],args);return this}})(b)};Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]};Kinetic.Transform.prototype={translate:function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b;this.m[5]+=this.m[1]*a+this.m[3]*b},scale:function(a,b){this.m[0]*=a;this.m[1]*=a;this.m[2]*=b;this.m[3]*=b},rotate:function(a){var b=
Math.cos(a);a=Math.sin(a);var d=this.m[1]*b+this.m[3]*a,c=this.m[0]*-a+this.m[2]*b,h=this.m[1]*-a+this.m[3]*b;this.m[0]=this.m[0]*b+this.m[2]*a;this.m[1]=d;this.m[2]=c;this.m[3]=h},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(a,b){var d=this.m[1]+this.m[3]*b,c=this.m[2]+this.m[0]*a,h=this.m[3]+this.m[1]*a;this.m[0]+=this.m[2]*b;this.m[1]=d;this.m[2]=c;this.m[3]=h},multiply:function(a){var b=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],c=this.m[1]*
a.m[2]+this.m[3]*a.m[3],h=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],k=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=this.m[0]*a.m[0]+this.m[2]*a.m[1];this.m[1]=b;this.m[2]=d;this.m[3]=c;this.m[4]=h;this.m[5]=k},invert:function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=-this.m[1]*a,d=-this.m[2]*a,c=this.m[0]*a,h=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),k=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=this.m[3]*a;this.m[1]=b;this.m[2]=d;this.m[3]=c;this.m[4]=h;this.m[5]=
k},getMatrix:function(){return this.m},setAbsolutePosition:function(a,b){var d=this.m[0],c=this.m[1],h=this.m[2],k=this.m[4],c=(d*(b-this.m[5])-c*(a-k))/(d*this.m[3]-c*h);this.translate((a-k-h*c)/d,c)}};var c=Math.PI/180,a=180/Math.PI,d={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],
green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},b=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(a){return!(!a||1!=a.nodeType)},_isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},_isObject:function(a){return!!a&&a.constructor==Object},_isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},_isNumber:function(a){return"[object Number]"==Object.prototype.toString.call(a)},_isString:function(a){return"[object String]"==
Object.prototype.toString.call(a)},_hasMethods:function(a){var b=[],d;for(d in a)this._isFunction(a[d])&&b.push(d);return 0<b.length},_isInDocument:function(a){for(;a=a.parentNode;)if(a==document)return!0;return!1},_simplifyArray:function(a){var b=[],d=a.length,c=Kinetic.Util,h,k;for(h=0;h<d;h++)k=a[h],c._isNumber(k)?k=Math.round(1E3*k)/1E3:c._isString(k)||(k=k.toString()),b.push(k);return b},_getImage:function(a,b){var d,c;a?this._isElement(a)?b(a):this._isString(a)?(d=new Image,d.onload=function(){b(d)},
d.src=a):a.data?(c=document.createElement("canvas"),c.width=a.width,c.height=a.height,_context=c.getContext("2d"),_context.putImageData(a,0,0),this._getImage(c.toDataURL(),b)):b(null):b(null)},_getRGBAString:function(a){return["rgba(",a.red||0,",",a.green||0,",",a.blue||0,",",a.alpha||1,")"].join("")},_rgbToHex:function(a,b,d){return(16777216+(a<<16)+(b<<8)+d).toString(16).slice(1)},_hexToRgb:function(a){a=a.replace("#","");a=parseInt(a,16);return{r:a>>16&255,g:a>>8&255,b:a&255}},getRandomColor:function(){for(var a=
(16777215*Math.random()<<0).toString(16);6>a.length;)a="0"+a;return"#"+a},get:function(a,b){return void 0===a?b:a},getRGB:function(a){return a in d?(a=d[a],{r:a[0],g:a[1],b:a[2]}):"#"===a[0]?this._hexToRgb(a.substring(1)):"rgb("===a.substr(0,4)?(a=b.exec(a.replace(/ /g,"")),{r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}):{r:0,g:0,b:0}},_merge:function(a,b){var d=this._clone(b),c;for(c in a)this._isObject(a[c])?d[c]=this._merge(a[c],d[c]):d[c]=a[c];return d},cloneObject:function(a){var b=
{},d;for(d in a)this._isObject(a[d])?b[d]=this._clone(a[d]):b[d]=a[d];return b},cloneArray:function(a){return a.slice(0)},_degToRad:function(a){return a*c},_radToDeg:function(b){return b*a},_capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},error:function(a){throw Error("Kinetic error: "+a);},warn:function(a){window.console&&console.warn&&console.warn("Kinetic warning: "+a)},extend:function(a,b){for(var d in b.prototype)d in a.prototype||(a.prototype[d]=b.prototype[d])},addMethods:function(a,
b){for(var d in b)a.prototype[d]=b[d]},_getControlPoints:function(a,b,d,c,h,k,m){var p=Math.sqrt(Math.pow(d-a,2)+Math.pow(c-b,2)),r=Math.sqrt(Math.pow(h-d,2)+Math.pow(k-c,2)),n=m*p/(p+r);m=m*r/(p+r);return[d-n*(h-a),c-n*(k-b),d+m*(h-a),c+m*(k-b)]},_expandPoints:function(a,b){var d=a.length,c=[],h,k;for(h=2;h<d-2;h+=2)k=Kinetic.Util._getControlPoints(a[h-2],a[h-1],a[h],a[h+1],a[h+2],a[h+3],b),c.push(k[0]),c.push(k[1]),c.push(a[h]),c.push(a[h+1]),c.push(k[2]),c.push(k[3]);return c},_removeLastLetter:function(a){return a.substring(0,
a.length-1)}}})();
(function(){var c=document.createElement("canvas").getContext("2d"),a=(window.devicePixelRatio||1)/(c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1);Kinetic.Canvas=function(a){this.init(a)};Kinetic.Canvas.prototype={init:function(d){d=d||{};this.pixelRatio=d.pixelRatio||Kinetic.pixelRatio||a;this._canvas=document.createElement("canvas");this._canvas.style.padding=0;this._canvas.style.margin=0;this._canvas.style.border=
0;this._canvas.style.background="transparent";this._canvas.style.position="absolute";this._canvas.style.top=0;this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){this.pixelRatio=a;this.setSize(this.getWidth(),this.getHeight())},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio;this._canvas.style.width=a+"px"},setHeight:function(a){this.height=this._canvas.height=a*this.pixelRatio;this._canvas.style.height=
a+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,b){this.setWidth(a);this.setHeight(b)},toDataURL:function(a,b){try{return this._canvas.toDataURL(a,b)}catch(e){try{return this._canvas.toDataURL()}catch(f){return Kinetic.Util.warn("Unable to get data URL. "+f.message),""}}}};Kinetic.SceneCanvas=function(a){a=a||{};var b=a.width||0,e=a.height||0;Kinetic.Canvas.call(this,a);this.context=new Kinetic.SceneContext(this);this.setSize(b,e)};Kinetic.SceneCanvas.prototype=
{setWidth:function(a){var b=this.pixelRatio,e=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,a);e.scale(b,b)},setHeight:function(a){var b=this.pixelRatio,e=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,a);e.scale(b,b)}};Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas);Kinetic.HitCanvas=function(a){a=a||{};var b=a.width||0,e=a.height||0;Kinetic.Canvas.call(this,a);this.context=new Kinetic.HitContext(this);this.setSize(b,e)};Kinetic.Util.extend(Kinetic.HitCanvas,
Kinetic.Canvas)})();
(function(){var c="arc arcTo beginPath bezierCurveTo clearRect clip closePath createLinearGradient createPattern createRadialGradient drawImage fill fillText getImageData createImageData lineTo moveTo putImageData quadraticCurveTo rect restore rotate save scale setLineDash setTransform stroke strokeText transform translate".split(" ");Kinetic.Context=function(a){this.init(a)};Kinetic.Context.prototype={init:function(a){this.canvas=a;this._context=a._canvas.getContext("2d");Kinetic.enableTrace&&(this.traceArr=
[],this._enableTrace())},fillShape:function(a){a.getFillEnabled()&&this._fill(a)},strokeShape:function(a){a.getStrokeEnabled()&&this._stroke(a)},fillStrokeShape:function(a){a.getFillEnabled()&&this._fill(a);a.getStrokeEnabled()&&this._stroke(a)},getTrace:function(a){var d=this.traceArr,b=d.length,e="",f,c,g;for(f=0;f<b;f++)c=d[f],(g=c.method)?(c=c.args,e+=g,e=a?e+"()":Kinetic.Util._isArray(c[0])?e+("(["+c.join(",")+"])"):e+("("+c.join(",")+")")):(e+=c.property,a||(e+="="+c.val)),e+=";";return e},
clearTrace:function(){this.traceArr=[]},_trace:function(a){var d=this.traceArr;d.push(a);d.length>=Kinetic.traceArrMax&&d.shift()},reset:function(){var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)},getCanvas:function(){return this.canvas},clear:function(a){var d=this.getCanvas();a?this.clearRect(a.x||0,a.y||0,a.width||0,a.height||0):this.clearRect(0,0,d.getWidth(),d.getHeight())},_applyLineCap:function(a){(a=a.getLineCap())&&this.setAttr("lineCap",a)},_applyOpacity:function(a){a=
a.getAbsoluteOpacity();1!==a&&this.setAttr("globalAlpha",a)},_applyLineJoin:function(a){(a=a.getLineJoin())&&this.setAttr("lineJoin",a)},_applyTransform:function(a){var d=a.getTransformsEnabled();"all"===d?(a=a.getAbsoluteTransform().getMatrix(),this.transform(a[0],a[1],a[2],a[3],a[4],a[5])):"position"===d&&this.translate(a.getX(),a.getY())},setAttr:function(a,d){this._context[a]=d},arc:function(){var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])},beginPath:function(){this._context.beginPath()},
bezierCurveTo:function(){var a=arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])},clearRect:function(){var a=arguments;this._context.clearRect(a[0],a[1],a[2],a[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var a=arguments;if(2===a.length)return this._context.createImageData(a[0],a[1]);if(1===a.length)return this._context.createImageData(a[0])},createLinearGradient:function(){var a=arguments;return this._context.createLinearGradient(a[0],
a[1],a[2],a[3])},createPattern:function(){var a=arguments;return this._context.createPattern(a[0],a[1])},createRadialGradient:function(){var a=arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])},drawImage:function(){var a=arguments,d=this._context;3===a.length?d.drawImage(a[0],a[1],a[2]):5===a.length?d.drawImage(a[0],a[1],a[2],a[3],a[4]):9===a.length&&d.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},fill:function(){this._context.fill()},fillText:function(){var a=
arguments;this._context.fillText(a[0],a[1],a[2])},getImageData:function(){var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])},lineTo:function(){var a=arguments;this._context.lineTo(a[0],a[1])},moveTo:function(){var a=arguments;this._context.moveTo(a[0],a[1])},rect:function(){var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])},putImageData:function(){var a=arguments;this._context.putImageData(a[0],a[1],a[2])},quadraticCurveTo:function(){var a=arguments;this._context.quadraticCurveTo(a[0],
a[1],a[2],a[3])},restore:function(){this._context.restore()},rotate:function(){this._context.rotate(arguments[0])},save:function(){this._context.save()},scale:function(){var a=arguments;this._context.scale(a[0],a[1])},setLineDash:function(){var a=arguments,d=this._context;this._context.setLineDash?d.setLineDash(a[0]):"mozDash"in d?d.mozDash=a[0]:"webkitLineDash"in d&&(d.webkitLineDash=a[0])},setTransform:function(){var a=arguments;this._context.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])},stroke:function(){this._context.stroke()},
strokeText:function(){var a=arguments;this._context.strokeText(a[0],a[1],a[2])},transform:function(){var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])},translate:function(){var a=arguments;this._context.translate(a[0],a[1])},_enableTrace:function(){var a=this,d=c.length,b=Kinetic.Util._simplifyArray,e=this.setAttr,f,l;for(f=0;f<d;f++)(function(e){var d=a[e],f;a[e]=function(){l=b(Array.prototype.slice.call(arguments,0));f=d.apply(a,arguments);a._trace({method:e,args:l});return f}})(c[f]);
a.setAttr=function(){e.apply(a,arguments);a._trace({property:arguments[0],val:arguments[1]})}}};Kinetic.SceneContext=function(a){Kinetic.Context.call(this,a)};Kinetic.SceneContext.prototype={_fillColor:function(a){var d=a.fill()||Kinetic.Util._getRGBAString({red:a.fillRed(),green:a.fillGreen(),blue:a.fillBlue(),alpha:a.fillAlpha()});this.setAttr("fillStyle",d);a._fillFunc(this)},_fillPattern:function(a){var d=a.getFillPatternImage(),b=a.getFillPatternX(),e=a.getFillPatternY(),f=a.getFillPatternScale(),
c=a.getFillPatternRotation(),g=a.getFillPatternOffset();a=a.getFillPatternRepeat();(b||e)&&this.translate(b||0,e||0);c&&this.rotate(c);f&&this.scale(f.x,f.y);g&&this.translate(-1*g.x,-1*g.y);this.setAttr("fillStyle",this.createPattern(d,a||"repeat"));this.fill()},_fillLinearGradient:function(a){var d=a.getFillLinearGradientStartPoint(),b=a.getFillLinearGradientEndPoint();a=a.getFillLinearGradientColorStops();d=this.createLinearGradient(d.x,d.y,b.x,b.y);if(a){for(b=0;b<a.length;b+=2)d.addColorStop(a[b],
a[b+1]);this.setAttr("fillStyle",d);this.fill()}},_fillRadialGradient:function(a){var d=a.getFillRadialGradientStartPoint(),b=a.getFillRadialGradientEndPoint(),e=a.getFillRadialGradientStartRadius(),f=a.getFillRadialGradientEndRadius();a=a.getFillRadialGradientColorStops();d=this.createRadialGradient(d.x,d.y,e,b.x,b.y,f);for(b=0;b<a.length;b+=2)d.addColorStop(a[b],a[b+1]);this.setAttr("fillStyle",d);this.fill()},_fill:function(a){var d=a.fill()||a.fillRed()||a.fillGreen()||a.fillBlue(),b=a.getFillPatternImage(),
e=a.getFillLinearGradientColorStops(),f=a.getFillRadialGradientColorStops(),c=a.getFillPriority();d&&"color"===c?this._fillColor(a):b&&"pattern"===c?this._fillPattern(a):e&&"linear-gradient"===c?this._fillLinearGradient(a):f&&"radial-gradient"===c?this._fillRadialGradient(a):d?this._fillColor(a):b?this._fillPattern(a):e?this._fillLinearGradient(a):f&&this._fillRadialGradient(a)},_stroke:function(a){var d=a.dash(),b=a.getStrokeScaleEnabled();a.hasStroke()&&(b||(this.save(),this.setTransform(1,0,0,
1,0,0)),this._applyLineCap(a),d&&a.dashEnabled()&&this.setLineDash(d),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.stroke()||Kinetic.Util._getRGBAString({red:a.strokeRed(),green:a.strokeGreen(),blue:a.strokeBlue(),alpha:a.strokeAlpha()})),a._strokeFunc(this),b||this.restore())},_applyShadow:function(a){var d=Kinetic.Util,b=a.getAbsoluteOpacity(),e=d.get(a.getShadowColor(),"black"),f=d.get(a.getShadowBlur(),5),c=d.get(a.getShadowOpacity(),0);a=d.get(a.getShadowOffset(),{x:0,
y:0});c&&this.setAttr("globalAlpha",c*b);this.setAttr("shadowColor",e);this.setAttr("shadowBlur",f);this.setAttr("shadowOffsetX",a.x);this.setAttr("shadowOffsetY",a.y)}};Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context);Kinetic.HitContext=function(a){Kinetic.Context.call(this,a)};Kinetic.HitContext.prototype={_fill:function(a){this.save();this.setAttr("fillStyle",a.colorKey);a._fillFuncHit(this);this.restore()},_stroke:function(a){a.hasStroke()&&(this._applyLineCap(a),this.setAttr("lineWidth",
a.strokeWidth()),this.setAttr("strokeStyle",a.colorKey),a._strokeFuncHit(this))}};Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)})();
(function(){Kinetic.Factory={addGetterSetter:function(c,a,d,b,e){this.addGetter(c,a,d);this.addSetter(c,a,b,e);this.addOverloadedGetterSetter(c,a)},addGetter:function(c,a,d){var b="get"+Kinetic.Util._capitalize(a);c.prototype[b]=function(){var b=this.attrs[a];return void 0===b?d:b}},addSetter:function(c,a,d,b){var e="set"+Kinetic.Util._capitalize(a);c.prototype[e]=function(e){d&&(e=d.call(this,e));this._setAttr(a,e);b&&b.call(this);return this}},addComponentsGetterSetter:function(c,a,d,b,e){var f=
d.length,l=Kinetic.Util._capitalize,g="get"+l(a),h="set"+l(a),k,m;c.prototype[g]=function(){var b={};for(k=0;k<f;k++)m=d[k],b[m]=this.getAttr(a+l(m));return b};c.prototype[h]=function(d){var f=this.attrs[a],c;b&&(d=b.call(this,d));for(c in d)this._setAttr(a+l(c),d[c]);this._fireChangeEvent(a,f,d);e&&e.call(this);return this};this.addOverloadedGetterSetter(c,a)},addOverloadedGetterSetter:function(c,a){var d=Kinetic.Util._capitalize(a),b="set"+d,e="get"+d;c.prototype[a]=function(){return arguments.length?
(this[b](arguments[0]),this):this[e]()}},backCompat:function(c,a){for(var d in a)c.prototype[d]=c.prototype[a[d]]},afterSetFilter:function(){this._filterUpToDate=!1}};Kinetic.Validators={RGBComponent:function(c){return 255<c?255:0>c?0:Math.round(c)},alphaComponent:function(c){return 1<c?1:1E-4>c?1E-4:c}}})();
(function(){var c="Shape";Kinetic.Util.addMethods(Kinetic.Node,{_init:function(a){var d=this;this._id=Kinetic.idCounter++;this.eventListeners={};this.attrs={};this._cache={};this._filterUpToDate=!1;this.setAttrs(a);this.on("xChange.kinetic yChange.kinetic scaleXChange.kinetic scaleYChange.kinetic skewXChange.kinetic skewYChange.kinetic rotationChange.kinetic offsetXChange.kinetic offsetYChange.kinetic transformsEnabledChange.kinetic",function(){this._clearCache("transform");d._clearSelfAndDescendantCache("absoluteTransform")});
this.on("visibleChange.kinetic",function(){d._clearSelfAndDescendantCache("visible")});this.on("listeningChange.kinetic",function(){d._clearSelfAndDescendantCache("listening")});this.on("opacityChange.kinetic",function(){d._clearSelfAndDescendantCache("absoluteOpacity")})},_clearCache:function(a){a?delete this._cache[a]:this._cache={}},_getCache:function(a,d){void 0===this._cache[a]&&(this._cache[a]=d.call(this));return this._cache[a]},_clearSelfAndDescendantCache:function(a){this._clearCache(a);
this.children&&this.getChildren().each(function(d){d._clearSelfAndDescendantCache(a)})},clearCache:function(){delete this._cache.canvas;this._filterUpToDate=!1;return this},cache:function(a){var d=a||{},b=d.x||0,e=d.y||0;a=d.width||this.width();var f=d.height||this.height(),c=d.drawBorder||!1,d=new Kinetic.SceneCanvas({pixelRatio:1,width:a,height:f}),g=new Kinetic.SceneCanvas({pixelRatio:1,width:a,height:f}),h=new Kinetic.HitCanvas({width:a,height:f}),k=this.transformsEnabled(),m=this.x(),p=this.y();
this.clearCache();this.transformsEnabled("position");this.x(-1*b);this.y(-1*e);this.drawScene(d);this.drawHit(h);c&&(b=d.getContext(),b.save(),b.beginPath(),b.rect(0,0,a,f),b.closePath(),b.setAttr("strokeStyle","red"),b.setAttr("lineWidth",5),b.stroke(),b.restore());this.x(m);this.y(p);this.transformsEnabled(k);this._cache.canvas={scene:d,filter:g,hit:h};return this},_drawCachedSceneCanvas:function(a){a.save();a._applyTransform(this);a.drawImage(this._getCachedSceneCanvas()._canvas,0,0);a.restore()},
_getCachedSceneCanvas:function(){var a=this.filters(),d=this._cache.canvas,b=d.scene,d=d.filter,e=d.getContext(),f,c,g,h;if(a){if(!this._filterUpToDate){try{for(f=a.length,e.clear(),e.drawImage(b._canvas,0,0),c=e.getImageData(0,0,d.getWidth(),d.getHeight()),g=0;g<f;g++)h=a[g],h.call(this,c),e.putImageData(c,0,0)}catch(k){Kinetic.Util.warn("Unable to apply filter. "+k.message)}this._filterUpToDate=!0}return d}return b},_drawCachedHitCanvas:function(a){var d=this._cache.canvas.hit;a.save();a._applyTransform(this);
a.drawImage(d._canvas,0,0);a.restore()},on:function(a,d){var b=a.split(" "),e=b.length,f,c,g;for(f=0;f<e;f++)c=b[f],g=c.split("."),c=g[0],g=g[1]||"",this.eventListeners[c]||(this.eventListeners[c]=[]),this.eventListeners[c].push({name:g,handler:d});return this},off:function(a){a=a.split(" ");var d=a.length,b,e,f,c;for(b=0;b<d;b++)if(f=a[b],c=f.split("."),f=c[0],c=c[1],f)this.eventListeners[f]&&this._off(f,c);else for(e in this.eventListeners)this._off(e,c);return this},remove:function(){var a=this.getParent();
a&&a.children&&(a.children.splice(this.index,1),a._setChildrenIndices(),delete this.parent);this._clearSelfAndDescendantCache("stage");this._clearSelfAndDescendantCache("absoluteTransform");this._clearSelfAndDescendantCache("visible");this._clearSelfAndDescendantCache("listening");this._clearSelfAndDescendantCache("absoluteOpacity");return this},destroy:function(){Kinetic._removeId(this.getId());Kinetic._removeName(this.getName(),this._id);this.remove()},getAttr:function(a){var d="get"+Kinetic.Util._capitalize(a);
return Kinetic.Util._isFunction(this[d])?this[d]():this.attrs[a]},getAncestors:function(){for(var a=this.getParent(),d=new Kinetic.Collection;a;)d.push(a),a=a.getParent();return d},getAttrs:function(){return this.attrs||{}},setAttrs:function(a){var d,b;if(a)for(d in a)if("children"!==d)if(b="set"+Kinetic.Util._capitalize(d),Kinetic.Util._isFunction(this[b]))this[b](a[d]);else this._setAttr(d,a[d]);return this},isListening:function(){return this._getCache("listening",this._isListening)},_isListening:function(){var a=
this.getListening(),d=this.getParent();return"inherit"===a?d?d.isListening():!0:a},isVisible:function(){return this._getCache("visible",this._isVisible)},_isVisible:function(){var a=this.getVisible(),d=this.getParent();return"inherit"===a?d?d.isVisible():!0:a},shouldDrawHit:function(){var a=this.getLayer();return a&&a.hitGraphEnabled()&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},show:function(){this.setVisible(!0);return this},hide:function(){this.setVisible(!1);return this},getZIndex:function(){return this.index||
0},getAbsoluteZIndex:function(){function a(k){f=[];l=k.length;for(g=0;g<l;g++)h=k[g],e++,h.nodeType!==c&&(f=f.concat(h.getChildren().toArray())),h._id===b._id&&(g=l);0<f.length&&f[0].getDepth()<=d&&a(f)}var d=this.getDepth(),b=this,e=0,f,l,g,h;"Stage"!==b.nodeType&&a(b.getStage().getChildren());return e},getDepth:function(){for(var a=0,d=this.parent;d;)a++,d=d.parent;return a},setPosition:function(a){this.setX(a.x);this.setY(a.y);return this},getPosition:function(){return{x:this.getX(),y:this.getY()}},
getAbsolutePosition:function(){var a=this.getAbsoluteTransform().getMatrix(),d=new Kinetic.Transform,b=this.offset();d.m=a.slice();d.translate(b.x,b.y);return d.getTranslation()},setAbsolutePosition:function(a){var d=this._clearTransform(),b;this.attrs.x=d.x;this.attrs.y=d.y;delete d.x;delete d.y;b=this.getAbsoluteTransform();b.invert();b.translate(a.x,a.y);a={x:this.attrs.x+b.getTranslation().x,y:this.attrs.y+b.getTranslation().y};this.setPosition({x:a.x,y:a.y});this._setTransform(d);return this},
_setTransform:function(a){for(var d in a)this.attrs[d]=a[d];this._clearCache("transform");this._clearSelfAndDescendantCache("absoluteTransform")},_clearTransform:function(){var a={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};this.attrs.x=0;this.attrs.y=0;this.attrs.rotation=0;this.attrs.scaleX=1;this.attrs.scaleY=1;this.attrs.offsetX=0;this.attrs.offsetY=
0;this.attrs.skewX=0;this.attrs.skewY=0;this._clearCache("transform");this._clearSelfAndDescendantCache("absoluteTransform");return a},move:function(a){var d=a.x;a=a.y;var b=this.getX(),e=this.getY();void 0!==d&&(b+=d);void 0!==a&&(e+=a);this.setPosition({x:b,y:e});return this},_eachAncestorReverse:function(a,d){var b=[],e=this.getParent(),f;for(d&&b.unshift(this);e;)b.unshift(e),e=e.parent;e=b.length;for(f=0;f<e;f++)a(b[f])},rotate:function(a){this.setRotation(this.getRotation()+a);return this},
moveToTop:function(){this.parent.children.splice(this.index,1);this.parent.children.push(this);this.parent._setChildrenIndices();return!0},moveUp:function(){var a=this.index,d=this.parent.getChildren().length;return a<d-1?(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){var a=this.index;return 0<a?(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0):!1},
moveToBottom:function(){var a=this.index;return 0<a?(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(a){this.parent.children.splice(this.index,1);this.parent.children.splice(a,0,this);this.parent._setChildrenIndices();return this},getAbsoluteOpacity:function(){return this._getCache("absoluteOpacity",this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();this.getParent()&&(a*=this.getParent().getAbsoluteOpacity());
return a},moveTo:function(a){Kinetic.Node.prototype.remove.call(this);a.add(this);return this},toObject:function(){var a=Kinetic.Util,d={},b=this.getAttrs(),e,f,c;d.attrs={};for(e in b)f=b[e],a._isFunction(f)||a._isElement(f)||a._isObject(f)&&a._hasMethods(f)||(c=this[e],delete b[e],c=c?c.call(this):null,b[e]=f,c!==f&&(d.attrs[e]=f));d.className=this.getClassName();return d},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var a=
this.getParent();return a?a.getLayer():null},getStage:function(){return this._getCache("stage",this._getStage)},_getStage:function(){var a=this.getParent();if(a)return a.getStage()},fire:function(a,d,b){b?this._fireAndBubble(a,d||{}):this._fire(a,d||{});return this},getAbsoluteTransform:function(){return this._getCache("absoluteTransform",this._getAbsoluteTransform)},_getAbsoluteTransform:function(){var a=new Kinetic.Transform,d,b;this._eachAncestorReverse(function(e){d=e.transformsEnabled();b=e.getTransform();
"all"===d?a.multiply(b):"position"===d&&a.translate(e.x(),e.y())},!0);return a},getTransform:function(){return this._getCache("transform",this._getTransform)},_getTransform:function(){var a=new Kinetic.Transform,d=this.getX(),b=this.getY(),e=this.getRotation()*Math.PI/180,f=this.getScaleX(),c=this.getScaleY(),g=this.getSkewX(),h=this.getSkewY(),k=this.getOffsetX(),m=this.getOffsetY();0===d&&0===b||a.translate(d,b);0!==e&&a.rotate(e);0===g&&0===h||a.skew(g,h);1===f&&1===c||a.scale(f,c);0===k&&0===
m||a.translate(-1*k,-1*m);return a},clone:function(a){var d=this.getClassName(),d=new Kinetic[d](this.attrs),b,e,f,c,g;for(b in this.eventListeners)for(e=this.eventListeners[b],f=e.length,c=0;c<f;c++)g=e[c],0>g.name.indexOf("kinetic")&&(d.eventListeners[b]||(d.eventListeners[b]=[]),d.eventListeners[b].push(g));d.setAttrs(a);return d},toDataURL:function(a){a=a||{};var d=a.mimeType||null,b=a.quality||null,e=this.getStage(),f=a.x||0,c=a.y||0;a=new Kinetic.SceneCanvas({width:a.width||this.getWidth()||
(e?e.getWidth():0),height:a.height||this.getHeight()||(e?e.getHeight():0),pixelRatio:1});e=a.getContext();e.save();(f||c)&&e.translate(-1*f,-1*c);this.drawScene(a);e.restore();return a.toDataURL(d,b)},toImage:function(a){Kinetic.Util._getImage(this.toDataURL(a),function(d){a.callback(d)})},setSize:function(a){this.setWidth(a.width);this.setHeight(a.height);return this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||
0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},_get:function(a){return this.nodeType===a?[this]:[]},_off:function(a,d){var b=this.eventListeners[a],e,f;for(e=0;e<b.length;e++)if(f=b[e].name,!("kinetic"===f&&"kinetic"!==d||d&&f!==d)){b.splice(e,1);if(0===b.length){delete this.eventListeners[a];break}e--}},_fireBeforeChangeEvent:function(a,d,b){this._fire(["before",Kinetic.Util._capitalize(a),"Change"].join(""),{oldVal:d,newVal:b})},_fireChangeEvent:function(a,
d,b){this._fire(a+"Change",{oldVal:d,newVal:b})},setId:function(a){var d=this.getId();Kinetic._removeId(d);Kinetic._addId(this,a);this._setAttr("id",a);return this},setName:function(a){var d=this.getName();Kinetic._removeName(d,this._id);Kinetic._addName(this,a);this._setAttr("name",a);return this},setAttr:function(){var a=Array.prototype.slice.call(arguments),d=a[0],a=a[1],b=this["set"+Kinetic.Util._capitalize(d)];Kinetic.Util._isFunction(b)?b.call(this,a):this._setAttr(d,a);return this},_setAttr:function(a,
d){var b;void 0!==d&&(b=this.attrs[a],this.attrs[a]=d,this._fireChangeEvent(a,b,d))},_setComponentAttr:function(a,d,b){var e;void 0!==b&&((e=this.attrs[a])||(this.attrs[a]=this.getAttr(a)),this.attrs[a][d]=b,this._fireChangeEvent(a,e,b))},_fireAndBubble:function(a,d,b){var e=!0;d&&this.nodeType===c&&(d.targetNode=this);"mouseenter"===a&&b&&this._id===b._id?e=!1:"mouseleave"===a&&b&&this._id===b._id&&(e=!1);e&&(this._fire(a,d),d&&!d.cancelBubble&&this.parent&&(b&&b.parent?this._fireAndBubble.call(this.parent,
a,d,b.parent):this._fireAndBubble.call(this.parent,a,d)))},_fire:function(a,d){var b=this.eventListeners[a],e;if(b)for(e=0;e<b.length;e++)b[e].handler.call(this,d)},draw:function(){this.drawScene();this.drawHit();return this}});Kinetic.Node.create=function(a,d){return this._createNode(JSON.parse(a),d)};Kinetic.Node._createNode=function(a,d){var b=Kinetic.Node.prototype.getClassName.call(a),e=a.children,f,c;d&&(a.attrs.container=d);b=new Kinetic[b](a.attrs);if(e)for(f=e.length,c=0;c<f;c++)b.add(this._createNode(e[c]));
return b};Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position");Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1);Kinetic.Factory.addGetter(Kinetic.Node,"name");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name");Kinetic.Factory.addGetter(Kinetic.Node,"id");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id");Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",
0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",
0);Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0);Kinetic.Factory.addSetter(Kinetic.Node,"width",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width");Kinetic.Factory.addSetter(Kinetic.Node,"height",0);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height");Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,"filters",void 0,function(a){this._filterUpToDate=!1;return a});Kinetic.Factory.addGetterSetter(Kinetic.Node,
"visible","inherit");Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all");Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});Kinetic.Collection.mapMethods(Kinetic.Node)})();(function(){Kinetic.Filters.Grayscale=function(c){c=c.data;var a=c.length,d,b;for(d=0;d<a;d+=4)b=0.34*c[d]+0.5*c[d+1]+0.16*c[d+2],c[d]=b,c[d+1]=b,c[d+2]=b}})();
(function(){Kinetic.Filters.Brighten=function(c){var a=255*this.brightness();c=c.data;var d=c.length,b;for(b=0;b<d;b+=4)c[b]+=a,c[b+1]+=a,c[b+2]+=a};Kinetic.Factory.addGetterSetter(Kinetic.Node,"brightness",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Invert=function(c){c=c.data;var a=c.length,d;for(d=0;d<a;d+=4)c[d]=255-c[d],c[d+1]=255-c[d+1],c[d+2]=255-c[d+2]}})();
(function(){function c(){this.a=this.b=this.g=this.r=0;this.next=null}var a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,
367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,
310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],d=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,
23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(b){var e=this.blurRadius()|0;if(0<e){var f=b.data,l=b.width;b=b.height;var g,h,k,m,p,r,n,q,s,u,w,z,v,x,y,G,A,E,I,
K,J,C,F;g=e+e+1;var M=l-1,L=b-1,D=e+1,B=D*(D+1)/2,N=new c,Q=null,H=N;F=k=null;var O=a[e],P=d[e];for(k=1;k<g;k++)H=H.next=new c,k==D&&(Q=H);H.next=N;for(h=r=p=0;h<b;h++){y=G=A=E=n=q=s=u=0;w=D*(I=f[p]);z=D*(K=f[p+1]);v=D*(J=f[p+2]);x=D*(C=f[p+3]);n+=B*I;q+=B*K;s+=B*J;u+=B*C;H=N;for(k=0;k<D;k++)H.r=I,H.g=K,H.b=J,H.a=C,H=H.next;for(k=1;k<D;k++)m=p+((M<k?M:k)<<2),n+=(H.r=I=f[m])*(F=D-k),q+=(H.g=K=f[m+1])*F,s+=(H.b=J=f[m+2])*F,u+=(H.a=C=f[m+3])*F,y+=I,G+=K,A+=J,E+=C,H=H.next;k=N;F=Q;for(g=0;g<l;g++)f[p+
3]=C=u*O>>P,0!==C?(C=255/C,f[p]=(n*O>>P)*C,f[p+1]=(q*O>>P)*C,f[p+2]=(s*O>>P)*C):f[p]=f[p+1]=f[p+2]=0,n-=w,q-=z,s-=v,u-=x,w-=k.r,z-=k.g,v-=k.b,x-=k.a,m=r+((m=g+e+1)<M?m:M)<<2,y+=k.r=f[m],G+=k.g=f[m+1],A+=k.b=f[m+2],E+=k.a=f[m+3],n+=y,q+=G,s+=A,u+=E,k=k.next,w+=I=F.r,z+=K=F.g,v+=J=F.b,x+=C=F.a,y-=I,G-=K,A-=J,E-=C,F=F.next,p+=4;r+=l}for(g=0;g<l;g++){G=A=E=y=q=s=u=n=0;p=g<<2;w=D*(I=f[p]);z=D*(K=f[p+1]);v=D*(J=f[p+2]);x=D*(C=f[p+3]);n+=B*I;q+=B*K;s+=B*J;u+=B*C;H=N;for(k=0;k<D;k++)H.r=I,H.g=K,H.b=J,H.a=
C,H=H.next;m=l;for(k=1;k<=e;k++)p=m+g<<2,n+=(H.r=I=f[p])*(F=D-k),q+=(H.g=K=f[p+1])*F,s+=(H.b=J=f[p+2])*F,u+=(H.a=C=f[p+3])*F,y+=I,G+=K,A+=J,E+=C,H=H.next,k<L&&(m+=l);p=g;k=N;F=Q;for(h=0;h<b;h++)m=p<<2,f[m+3]=C=u*O>>P,0<C?(C=255/C,f[m]=(n*O>>P)*C,f[m+1]=(q*O>>P)*C,f[m+2]=(s*O>>P)*C):f[m]=f[m+1]=f[m+2]=0,n-=w,q-=z,s-=v,u-=x,w-=k.r,z-=k.g,v-=k.b,x-=k.a,m=g+((m=h+D)<L?m:L)*l<<2,n+=y+=k.r=f[m],q+=G+=k.g=f[m+1],s+=A+=k.b=f[m+2],u+=E+=k.a=f[m+3],k=k.next,w+=I=F.r,z+=K=F.g,v+=J=F.b,x+=C=F.a,y-=I,G-=K,A-=
J,E-=C,F=F.next,p+=l}}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"blurRadius",0,null,Kinetic.Factory.afterSetFilter)})();
(function(){function c(a,b,e){b=4*(e*a.width+b);e=[];e.push(a.data[b++],a.data[b++],a.data[b++],a.data[b++]);return e}function a(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}Kinetic.Filters.Mask=function(d){var b;b=this.threshold();var e=c(d,0,0),f=c(d,d.width-1,0),l=c(d,0,d.height-1),g=c(d,d.width-1,d.height-1);b=b||10;if(a(e,f)<b&&a(f,g)<b&&a(g,l)<b&&a(l,e)<b){f=[f,e,g,l];e=[0,0,0];for(l=0;l<f.length;l++)e[0]+=f[l][0],e[1]+=f[l][1],e[2]+=f[l][2];e[0]/=
f.length;e[1]/=f.length;e[2]/=f.length;f=[];for(l=0;l<d.width*d.height;l++)g=a(e,[d.data[4*l],d.data[4*l+1],d.data[4*l+2]]),f[l]=g<b?0:255;b=f}else b=void 0;if(b){for(var e=d.width,f=d.height,l=[1,1,1,1,0,1,1,1,1],g=Math.round(Math.sqrt(l.length)),h=Math.floor(g/2),k=[],m=0;m<f;m++)for(var p=0;p<e;p++){for(var r=m*e+p,n=0,q=0;q<g;q++)for(var s=0;s<g;s++){var u=m+q-h,w=p+s-h;0<=u&&u<f&&0<=w&&w<e&&(n+=b[u*e+w]*l[q*g+s])}k[r]=2040===n?255:0}b=k;e=d.width;f=d.height;l=[1,1,1,1,1,1,1,1,1];g=Math.round(Math.sqrt(l.length));
h=Math.floor(g/2);k=[];for(m=0;m<f;m++)for(p=0;p<e;p++){r=m*e+p;for(q=n=0;q<g;q++)for(s=0;s<g;s++)u=m+q-h,w=p+s-h,0<=u&&u<f&&0<=w&&w<e&&(n+=b[u*e+w]*l[q*g+s]);k[r]=1020<=n?255:0}b=k;e=d.width;f=d.height;l=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9];g=Math.round(Math.sqrt(l.length));h=Math.floor(g/2);k=[];for(m=0;m<f;m++)for(p=0;p<e;p++){r=m*e+p;for(q=n=0;q<g;q++)for(s=0;s<g;s++)u=m+q-h,w=p+s-h,0<=u&&u<f&&0<=w&&w<e&&(n+=b[u*e+w]*l[q*g+s]);k[r]=n}b=k;for(e=0;e<d.width*d.height;e++)d.data[4*e+3]=b[e]}return d};
Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0,null,Kinetic.Factory.afterSetFilter)})();
(function(){Kinetic.Filters.RGB=function(c){c=c.data;var a=c.length,d=this.red(),b=this.green(),e=this.blue(),f,l;for(f=0;f<a;f+=4)l=(0.34*c[f]+0.5*c[f+1]+0.16*c[f+2])/255,c[f]=l*d,c[f+1]=l*b,c[f+2]=l*e,c[f+3]=c[f+3]};Kinetic.Factory.addGetterSetter(Kinetic.Node,"red",0,function(c){this._filterUpToDate=!1;return 255<c?255:0>c?0:Math.round(c)});Kinetic.Factory.addGetterSetter(Kinetic.Node,"green",0,function(c){this._filterUpToDate=!1;return 255<c?255:0>c?0:Math.round(c)});Kinetic.Factory.addGetterSetter(Kinetic.Node,
"blue",0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)})();
(function(){Kinetic.Filters.HSV=function(c){c=c.data;for(var a=c.length,d=this.value(),b=this.saturation(),e=Math.abs(this.hue()+360)%360,f=d*b*Math.cos(e*Math.PI/180),l=d*b*Math.sin(e*Math.PI/180),b=0.299*d+0.701*f+0.167*l,e=0.587*d-0.587*f+0.33*l,g=0.114*d-0.114*f-0.497*l,h=0.299*d-0.299*f-0.328*l,k=0.587*d+0.413*f+0.035*l,m=0.114*d-0.114*f+0.293*l,p=0.299*d-0.3*f+1.25*l,r=0.587*d-0.586*f-1.05*l,f=0.114*d+0.886*f-0.2*l,n,q,s,d=0;d<a;d+=4)l=c[d+0],n=c[d+1],q=c[d+2],s=c[d+3],c[d+0]=b*l+e*n+g*q,c[d+
1]=h*l+k*n+m*q,c[d+2]=p*l+r*n+f*q,c[d+3]=s};Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",1,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"value",1,null,Kinetic.Factory.afterSetFilter)})();
(function(){Kinetic.Filters.Emboss=function(c){var a=10*this.embossStrength(),d=255*this.embossWhiteLevel(),b=this.embossDirection(),e=this.embossBlend(),f=0,l=0,g=c.data,h=c.width;c=c.height;var k=4*h,m=c;switch(b){case "top-left":l=f=-1;break;case "top":f=-1;l=0;break;case "top-right":f=-1;l=1;break;case "right":f=0;l=1;break;case "bottom-right":l=f=1;break;case "bottom":f=1;l=0;break;case "bottom-left":f=1;l=-1;break;case "left":f=0;l=-1;break}do{var b=(m-1)*k,p=f;1>m+p&&(p=0);m+p>c&&(p=0);var p=
(m-1+p)*h*4,r=h;do{var n=b+4*(r-1),q=l;1>r+q&&(q=0);r+q>h&&(q=0);var q=p+4*(r-1+q),s=g[n+1]-g[q+1],u=g[n+2]-g[q+2],q=g[n]-g[q],w=0<q?q:-q,z=0<u?u:-u;(0<s?s:-s)>w&&(q=s);z>w&&(q=u);q*=a;e?(s=g[n]+q,u=g[n+1]+q,q=g[n+2]+q,g[n]=255<s?255:0>s?0:s,g[n+1]=255<u?255:0>u?0:u,g[n+2]=255<q?255:0>q?0:q):(q=d-q,0>q?q=0:255<q&&(q=255),g[n]=g[n+1]=g[n+2]=q)}while(--r)}while(--m)};Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossStrength",0.5,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,
"embossWhiteLevel",0.5,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossDirection","top-left",null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossBlend",!1,null,Kinetic.Factory.afterSetFilter)})();
(function(){function c(a,d,b,e,f){b-=d;f-=e;return 0===b?e+f/2:0===f?e:a=(a-d)/b*f+e}Kinetic.Filters.Enhance=function(a){a=a.data;var d=a.length,b=a[0],e=b,f,l=a[1],g=l,h=a[2],k=h,m,p=this.enhance();if(0!==p){for(m=0;m<d;m+=4)f=a[m+0],f<b?b=f:f>e&&(e=f),f=a[m+1],f<l?l=f:f>g&&(g=f),f=a[m+2],f<h?h=f:f>k&&(k=f);e===b&&(e=255,b=0);g===l&&(g=255,l=0);k===h&&(k=255,h=0);var r,n,q,s;0<p?(f=e+p*(255-e),r=b-p*(b-0),n=g+p*(255-g),q=l-p*(l-0),s=k+p*(255-k),p=h-p*(h-0)):(m=0.5*(e+b),f=e+p*(e-m),r=b+p*(b-m),m=
0.5*(g+l),n=g+p*(g-m),q=l+p*(l-m),m=0.5*(k+h),s=k+p*(k-m),p=h+p*(h-m));for(m=0;m<d;m+=4)a[m+0]=c(a[m+0],b,e,r,f),a[m+1]=c(a[m+1],l,g,q,n),a[m+2]=c(a[m+2],h,k,p,s)}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"enhance",0,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Posterize=function(c){var a=Math.round(254*this.levels())+1;c=c.data;var d=c.length,a=255/a,b;for(b=0;b<d;b+=1)c[b]=Math.floor(c[b]/a)*a};Kinetic.Factory.addGetterSetter(Kinetic.Node,"levels",0.5,null,Kinetic.Factory.afterSetFilter)})();
(function(){Kinetic.Filters.Noise=function(c){var a=255*this.noise();c=c.data;var d=c.length,a=a/2,b;for(b=0;b<d;b+=4)c[b+0]+=a-2*a*Math.random(),c[b+1]+=a-2*a*Math.random(),c[b+2]+=a-2*a*Math.random()};Kinetic.Factory.addGetterSetter(Kinetic.Node,"noise",0.2,null,Kinetic.Factory.afterSetFilter)})();
(function(){Kinetic.Filters.Pixelate=function(c){var a=Math.ceil(this.pixelSize()),d=c.width,b=c.height;c=c.data;var e,f,l,g,h,k,m,p=Math.ceil(d/a),r=Math.ceil(b/a),n,q,s,u,w,z,v;for(w=0;w<p;w+=1)for(z=0;z<r;z+=1){m=k=h=g=0;n=w*a;q=n+a;s=z*a;u=s+a;v=0;for(e=n;e<q;e+=1)if(!(e>=d))for(f=s;f<u;f+=1)f>=b||(l=4*(d*f+e),g+=c[l+0],h+=c[l+1],k+=c[l+2],m+=c[l+3],v+=1);g/=v;h/=v;k/=v;alphas=m/v;for(e=n;e<q;e+=1)if(!(e>=d))for(f=s;f<u;f+=1)f>=b||(l=4*(d*f+e),c[l+0]=g,c[l+1]=h,c[l+2]=k,c[l+3]=m)}};Kinetic.Factory.addGetterSetter(Kinetic.Node,
"pixelSize",8,null,Kinetic.Factory.afterSetFilter)})();(function(){Kinetic.Filters.Threshold=function(c){var a=255*this.threshold();c=c.data;var d=c.length,b;for(b=0;b<d;b+=1)c[b]=c[b]<a?0:255};Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0.5,null,Kinetic.Factory.afterSetFilter)})();
(function(){Kinetic.Filters.Sepia=function(c){var a=c.data,d=c.width;c=c.height;var b=4*d,e,f,l,g,h,k,m,p;do{e=(c-1)*b;f=d;do l=e+4*(f-1),g=a[l],h=a[l+1],k=a[l+2],m=0.393*g+0.769*h+0.189*k,p=0.349*g+0.686*h+0.168*k,g=0.272*g+0.534*h+0.131*k,a[l]=255<m?255:m,a[l+1]=255<p?255:p,a[l+2]=255<g?255:g,a[l+3]=a[l+3];while(--f)}while(--c)}})();
(function(){Kinetic.Filters.Solarize=function(c){var a=c.data,d=c.width,b=4*d;c=c.height;do{var e=(c-1)*b,f=d;do{var l=e+4*(f-1),g=a[l],h=a[l+1],k=a[l+2];127<g&&(g=255-g);127<h&&(h=255-h);127<k&&(k=255-k);a[l]=g;a[l+1]=h;a[l+2]=k}while(--f)}while(--c)}})();
(function(){var c=document.createElement("canvas");Kinetic.Filters.Kaleidoscope=function(a){var d=a.width,b=a.height,e=Math.round(this.kaleidoscopePower()),f=Math.round(this.kaleidoscopeAngle()),l=Math.floor(f%360*d/360);if(!(1>e)){c.width=d;c.height=b;var f=c.getContext("2d").getImageData(0,0,d,b),g=a.data,h=f.data,k=a.width,m=a.height,p=d/2||k/2,r=b/2||m/2,n,q,s=0,u=0,w=0,z=0,v,x=Math.sqrt(p*p+r*r);q=k-p;n=m-r;v=Math.sqrt(q*q+n*n);var x=v>x?v:x,y,G=360/k*Math.PI/180,A,E,I,K,J,C,F,M,L,D;for(y=0;y<
k;y+=1)for(A=Math.sin(y*G),E=Math.cos(y*G),v=0;v<m;v+=1)q=p+x*v/m*E,n=r+x*v/m*A,1>=q&&(q=1),q>=k-0.5&&(q=k-1),1>=n&&(n=1),n>=m-0.5&&(n=m-1),I=q-0.5,q+=0.5,K=Math.floor(I),J=Math.floor(q),C=n-0.5,F=n+0.5,M=Math.floor(C),L=Math.floor(F),D=(1-(I-K))*(1-(C-M)),n=4*(M*k+K),s=g[n+0]*D,u=g[n+1]*D,w=g[n+2]*D,z=g[n+3]*D,D=(1-(I-K))*(F-L),n=4*(L*k+K),s+=g[n+0]*D,u+=g[n+1]*D,w+=g[n+2]*D,z+=g[n+3]*D,D=(q-J)*(F-L),n=4*(L*k+J),s+=g[n+0]*D,u+=g[n+1]*D,w+=g[n+2]*D,z+=g[n+3]*D,D=(q-J)*(1-(C-M)),n=4*(M*k+J),s+=g[n+
0]*D,u+=g[n+1]*D,w+=g[n+2]*D,z+=g[n+3]*D,n=4*(y+v*k),h[n+0]=s,h[n+1]=u,h[n+2]=w,h[n+3]=z;for(g=d/Math.pow(2,e);8>=g;)g*=2,e-=1;m=g=Math.ceil(g);p=0;r=m;x=1;l+g>d&&(p=m,r=0,x=-1);for(k=0;k<b;k+=1)for(h=p;h!==r;h+=x)m=Math.round(h+l)%d,A=4*(d*k+m),v=f.data[A+0],y=f.data[A+1],G=f.data[A+2],A=f.data[A+3],E=4*(d*k+h),f.data[E+0]=v,f.data[E+1]=y,f.data[E+2]=G,f.data[E+3]=A;for(k=0;k<b;k+=1)for(m=Math.floor(g),l=0;l<e;l+=1){for(h=0;h<m+1;h+=1)A=4*(d*k+h),v=f.data[A+0],y=f.data[A+1],G=f.data[A+2],A=f.data[A+
3],E=4*(d*k+2*m-h-1),f.data[E+0]=v,f.data[E+1]=y,f.data[E+2]=G,f.data[E+3]=A;m*=2}m={polarRotation:0};d=f.data;a=a.data;b=f.width;f=f.height;e=m.polarCenterX||b/2;l=m.polarCenterY||f/2;y=v=x=r=0;g=Math.sqrt(e*e+l*l);h=b-e;k=f-l;h=Math.sqrt(h*h+k*k);g=h>g?h:g;m=m.polarRotation||0;for(h=0;h<b;h+=1)for(k=0;k<f;k+=1)p=h-e,x=k-l,r=Math.sqrt(p*p+x*x)*f/g,x=(180*Math.atan2(x,p)/Math.PI+360+m)%360,x=x*b/360,p=x-0.5,G=x+0.5,A=Math.floor(p),E=Math.floor(G),I=r-0.5,K=r+0.5,J=Math.floor(I),C=Math.floor(K),n=
(1-(p-A))*(1-(I-J)),q=4*(J*b+A),r=d[q+0]*n,x=d[q+1]*n,v=d[q+2]*n,y=d[q+3]*n,n=(1-(p-A))*(K-C),q=4*(C*b+A),r+=d[q+0]*n,x+=d[q+1]*n,v+=d[q+2]*n,y+=d[q+3]*n,n=(G-E)*(K-C),q=4*(C*b+E),r+=d[q+0]*n,x+=d[q+1]*n,v+=d[q+2]*n,y+=d[q+3]*n,n=(G-E)*(1-(I-J)),q=4*(J*b+E),r+=d[q+0]*n,x+=d[q+1]*n,v+=d[q+2]*n,y+=d[q+3]*n,q=4*(k*b+h),a[q+0]=r,a[q+1]=x,a[q+2]=v,a[q+3]=y}};Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopePower",2,null,Kinetic.Factory.afterSetFilter);Kinetic.Factory.addGetterSetter(Kinetic.Node,
"kaleidoscopeAngle",0,null,Kinetic.Factory.afterSetFilter)})();
(function(){function c(a){window.setTimeout(a,1E3/60)}Kinetic.Animation=function(a,e){this.func=a;this.setLayers(e);this.id=Kinetic.Animation.animIdCounter++;this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}};Kinetic.Animation.prototype={setLayers:function(a){var e=[];this.layers=e=a?0<a.length?a:[a]:[]},getLayers:function(){return this.layers},addLayer:function(a){var e=this.layers,d,c;if(e)for(d=e.length,c=0;c<d;c++){if(e[c]._id===a._id)return!1}else this.layers=[];this.layers.push(a);
return!0},isRunning:function(){for(var a=Kinetic.Animation.animations,e=0;e<a.length;e++)if(a[e].id===this.id)return!0;return!1},start:function(){this.stop();this.frame.timeDiff=0;this.frame.lastTime=(new Date).getTime();Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(a){this.frame.timeDiff=a-this.frame.lastTime;this.frame.lastTime=a;this.frame.time+=this.frame.timeDiff;this.frame.frameRate=1E3/this.frame.timeDiff}};Kinetic.Animation.animations=
[];Kinetic.Animation.animIdCounter=0;Kinetic.Animation.animRunning=!1;Kinetic.Animation._addAnimation=function(a){this.animations.push(a);this._handleAnimation()};Kinetic.Animation._removeAnimation=function(a){a=a.id;for(var e=this.animations,d=e.length,c=0;c<d;c++)if(e[c].id===a){this.animations.splice(c,1);break}};Kinetic.Animation._runFrames=function(){var a={},e=this.animations,d,c,g,h,k,m,p,r;for(h=0;h<e.length;h++){d=e[h];c=d.layers;g=d.func;d._updateFrameObject((new Date).getTime());m=c.length;
for(k=0;k<m;k++)p=c[k],void 0!==p._id&&(a[p._id]=p);g&&g.call(d,d.frame)}for(r in a)a[r].draw()};Kinetic.Animation._animationLoop=function(){var a=this;0<this.animations.length?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){a._animationLoop()})):this.animRunning=!1};Kinetic.Animation._handleAnimation=function(){this.animRunning||(this.animRunning=!0,this._animationLoop())};var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||c;Kinetic.Animation.requestAnimFrame=function(b){(Kinetic.isDragging?c:a)(b)};var d=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(a){d.call(this,a)};Kinetic.Layer.prototype.batchDraw=function(){var a=this;this.batchAnim||(this.batchAnim=new Kinetic.Animation(function(){a.lastBatchDrawTime&&500<(new Date).getTime()-a.lastBatchDrawTime&&a.batchAnim.stop()},this));this.lastBatchDrawTime=(new Date).getTime();this.batchAnim.isRunning()||(this.draw(),
this.batchAnim.start())};Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(a){a.batchDraw()})}})();
(function(){var c={node:1,duration:1,easing:1,onFinish:1,yoyo:1},a=0;Kinetic.Tween=function(b){var e=this,f=b.node,l=f._id,g=b.duration||1,h=b.easing||Kinetic.Easings.Linear,k=!!b.yoyo,m;this.node=f;this._id=a++;this.anim=new Kinetic.Animation(function(){e.tween.onEnterFrame()},f.getLayer()||f.getLayers());this.tween=new d(m,function(a){e._tweenFunc(a)},h,0,1,1E3*g,k);this._addListeners();Kinetic.Tween.attrs[l]||(Kinetic.Tween.attrs[l]={});Kinetic.Tween.attrs[l][this._id]||(Kinetic.Tween.attrs[l][this._id]=
{});Kinetic.Tween.tweens[l]||(Kinetic.Tween.tweens[l]={});for(m in b)void 0===c[m]&&this._addAttr(m,b[m]);this.reset();this.onFinish=b.onFinish;this.onReset=b.onReset};Kinetic.Tween.attrs={};Kinetic.Tween.tweens={};Kinetic.Tween.prototype={_addAttr:function(a,e){var d=this.node,c=d._id,g,h,k;(g=Kinetic.Tween.tweens[c][a])&&delete Kinetic.Tween.attrs[c][g][a];d=d.getAttr(a);if(Kinetic.Util._isArray(e))for(g=[],k=e.length,h=0;h<k;h++)g.push(e[h]-d[h]);else g=e-d;Kinetic.Tween.attrs[c][this._id][a]=
{start:d,diff:g};Kinetic.Tween.tweens[c][a]=this._id},_tweenFunc:function(a){var e=this.node,d=Kinetic.Tween.attrs[e._id][this._id],c,g,h,k,m,p;for(c in d){g=d[c];h=g.start;g=g.diff;if(Kinetic.Util._isArray(h))for(k=[],p=h.length,m=0;m<p;m++)k.push(h[m]+g[m]*a);else k=h+g*a;e.setAttr(c,k)}},_addListeners:function(){var a=this;this.tween.onPlay=function(){a.anim.start()};this.tween.onReverse=function(){a.anim.start()};this.tween.onPause=function(){a.anim.stop()};this.tween.onFinish=function(){if(a.onFinish)a.onFinish()};
this.tween.onReset=function(){if(a.onReset)a.onReset()}},play:function(){this.tween.play();return this},reverse:function(){this.tween.reverse();return this},reset:function(){var a=this.node;this.tween.reset();(a.getLayer()||a.getLayers()).draw();return this},seek:function(a){var e=this.node;this.tween.seek(1E3*a);(e.getLayer()||e.getLayers()).draw();return this},pause:function(){this.tween.pause();return this},finish:function(){var a=this.node;this.tween.finish();(a.getLayer()||a.getLayers()).draw();
return this},destroy:function(){var a=this.node._id,e=this._id,d=Kinetic.Tween.tweens[a],c;this.pause();for(c in d)delete Kinetic.Tween.tweens[a][c];delete Kinetic.Tween.attrs[a][e]}};var d=function(a,e,d,c,g,h,k){this.prop=a;this.propFunc=e;this._pos=this.begin=c;this.duration=h;this.prevPos=this._change=0;this.yoyo=k;this._finish=this._startTime=this._position=this._time=0;this.func=d;this._change=g-this.begin;this.pause()};d.prototype={fire:function(a){(a=this[a])&&a()},setTime:function(a){a>this.duration?
this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>a?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())},getTime:function(){return this._time},setPosition:function(a){this.prevPos=this._pos;this.propFunc(a);this._pos=a},getPosition:function(a){void 0===a&&(a=this._time);return this.func(a,this.begin,this._change,this.duration)},play:function(){this.state=2;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onPlay")},reverse:function(){this.state=
3;this._time=this.duration-this._time;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onReverse")},seek:function(a){this.pause();this._time=a;this.update();this.fire("onSeek")},reset:function(){this.pause();this._time=0;this.update();this.fire("onReset")},finish:function(){this.pause();this._time=this.duration;this.update();this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var a=this.getTimer()-this._startTime;
2===this.state?this.setTime(a):3===this.state&&this.setTime(this.duration-a)},pause:function(){this.state=1;this.fire("onPause")},getTimer:function(){return(new Date).getTime()}};Kinetic.Easings={BackEaseIn:function(a,e,d,c,g,h){return d*(a/=c)*a*(2.70158*a-1.70158)+e},BackEaseOut:function(a,e,d,c,g,h){return d*((a=a/c-1)*a*(2.70158*a+1.70158)+1)+e},BackEaseInOut:function(a,e,d,c,g,h){g=1.70158;return 1>(a/=c/2)?d/2*a*a*(((g*=1.525)+1)*a-g)+e:d/2*((a-=2)*a*(((g*=1.525)+1)*a+g)+2)+e},ElasticEaseIn:function(a,
e,d,c,g,h){var k=0;if(0===a)return e;if(1==(a/=c))return e+d;h||(h=0.3*c);!g||g<Math.abs(d)?(g=d,k=h/4):k=h/(2*Math.PI)*Math.asin(d/g);return-(g*Math.pow(2,10*(a-=1))*Math.sin(2*(a*c-k)*Math.PI/h))+e},ElasticEaseOut:function(a,e,d,c,g,h){var k=0;if(0===a)return e;if(1==(a/=c))return e+d;h||(h=0.3*c);!g||g<Math.abs(d)?(g=d,k=h/4):k=h/(2*Math.PI)*Math.asin(d/g);return g*Math.pow(2,-10*a)*Math.sin(2*(a*c-k)*Math.PI/h)+d+e},ElasticEaseInOut:function(a,e,d,c,g,h){var k=0;if(0===a)return e;if(2==(a/=c/
2))return e+d;h||(h=0.3*c*1.5);!g||g<Math.abs(d)?(g=d,k=h/4):k=h/(2*Math.PI)*Math.asin(d/g);return 1>a?-0.5*g*Math.pow(2,10*(a-=1))*Math.sin(2*(a*c-k)*Math.PI/h)+e:g*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*c-k)*Math.PI/h)*0.5+d+e},BounceEaseOut:function(a,e,d,c){return(a/=c)<1/2.75?7.5625*d*a*a+e:a<2/2.75?d*(7.5625*(a-=1.5/2.75)*a+0.75)+e:a<2.5/2.75?d*(7.5625*(a-=2.25/2.75)*a+0.9375)+e:d*(7.5625*(a-=2.625/2.75)*a+0.984375)+e},BounceEaseIn:function(a,e,d,c){return d-Kinetic.Easings.BounceEaseOut(c-a,
0,d,c)+e},BounceEaseInOut:function(a,e,d,c){return a<c/2?0.5*Kinetic.Easings.BounceEaseIn(2*a,0,d,c)+e:0.5*Kinetic.Easings.BounceEaseOut(2*a-c,0,d,c)+0.5*d+e},EaseIn:function(a,e,d,c){return d*(a/=c)*a+e},EaseOut:function(a,e,d,c){return-d*(a/=c)*(a-2)+e},EaseInOut:function(a,e,d,c){return 1>(a/=c/2)?d/2*a*a+e:-d/2*(--a*(a-2)-1)+e},StrongEaseIn:function(a,d,c,l){return c*(a/=l)*a*a*a*a+d},StrongEaseOut:function(a,d,c,l){return c*((a=a/l-1)*a*a*a*a+1)+d},StrongEaseInOut:function(a,d,c,l){return 1>
(a/=l/2)?c/2*a*a*a*a*a+d:c/2*((a-=2)*a*a*a*a+2)+d},Linear:function(a,d,c,l){return c*a/l+d}}})();
(function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(a){var b=Kinetic.DD,e=b.node;e&&(e._setDragPosition(a),b.isDragging||(b.isDragging=!0,e.fire("dragstart",a,!0)),e.fire("dragmove",a,!0))},_endDragBefore:function(a){var b=Kinetic.DD,e=b.node,c;e&&(c=e.getLayer(),b.anim.stop(),b.isDragging&&(b.isDragging=!1,Kinetic.listenClickTap=!1,a&&(a.dragEndNode=e)),delete b.node,(c||e).draw())},_endDragAfter:function(a){a=a||{};var b=a.dragEndNode;a&&b&&
b.fire("dragend",a,!0)}};Kinetic.Node.prototype.startDrag=function(){var a=Kinetic.DD,b=this.getStage(),e=this.getLayer(),b=b.getPointerPosition(),c=this.getAbsolutePosition();b&&(a.node&&a.node.stopDrag(),a.node=this,a.offset.x=b.x-c.x,a.offset.y=b.y-c.y,a.anim.setLayers(e||this.getLayers()),a.anim.start(),this._setDragPosition())};Kinetic.Node.prototype._setDragPosition=function(a){var b=Kinetic.DD,e=this.getStage().getPointerPosition(),c=this.getDragBoundFunc(),b={x:e.x-b.offset.x,y:e.y-b.offset.y};
void 0!==c&&(b=c.call(this,b,a));this.setAbsolutePosition(b)};Kinetic.Node.prototype.stopDrag=function(){var a=Kinetic.DD,b={};a._endDragBefore(b);a._endDragAfter(b)};Kinetic.Node.prototype.setDraggable=function(a){this._setAttr("draggable",a);this._dragChange()};var c=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var a=Kinetic.DD;a.node&&a.node._id===this._id&&this.stopDrag();c.call(this)};Kinetic.Node.prototype.isDragging=function(){var a=Kinetic.DD;return a.node&&a.node._id===
this._id&&a.isDragging};Kinetic.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup();if("Stage"===this.getClassName())this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)});else this.on("mousedown.kinetic touchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)})};Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),b=Kinetic.DD;a&&b.node&&b.node._id===
this._id&&b.node.stopDrag()}};Kinetic.Node.prototype._dragCleanup=function(){"Stage"===this.getClassName()?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))};Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc");Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1);Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var a=document.documentElement;a.addEventListener("mouseup",Kinetic.DD._endDragBefore,
!0);a.addEventListener("touchend",Kinetic.DD._endDragBefore,!0);a.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1);a.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)})();
(function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(c){this.children=new Kinetic.Collection;Kinetic.Node.call(this,c)},getChildren:function(){return this.children},hasChildren:function(){return 0<this.getChildren().length},removeChildren:function(){for(var c=this.children,a;0<c.length;)a=c[0],a.hasChildren()&&a.removeChildren(),a.remove();return this},destroyChildren:function(){for(var c=this.children;0<c.length;)c[0].destroy();return this},add:function(c){var a=this.children;this._validateAdd(c);
c.index=a.length;c.parent=this;a.push(c);this._fire("add",{child:c});return this},destroy:function(){this.hasChildren()&&this.destroyChildren();Kinetic.Node.prototype.destroy.call(this)},find:function(c){var a=[];c=c.replace(/ /g,"").split(",");var d=c.length,b,e,f,l,g;for(b=0;b<d;b++)if(f=c[b],"#"===f.charAt(0))(e=this._getNodeById(f.slice(1)))&&a.push(e);else if("."===f.charAt(0))e=this._getNodesByName(f.slice(1)),a=a.concat(e);else for(l=this.getChildren(),g=l.length,e=0;e<g;e++)a=a.concat(l[e]._get(f));
return Kinetic.Collection.toCollection(a)},_getNodeById:function(c){c=Kinetic.ids[c];return void 0!==c&&this.isAncestorOf(c)?c:null},_getNodesByName:function(c){return this._getDescendants(Kinetic.names[c]||[])},_get:function(c){for(var a=Kinetic.Node.prototype._get.call(this,c),d=this.getChildren(),b=d.length,e=0;e<b;e++)a=a.concat(d[e]._get(c));return a},toObject:function(){var c=Kinetic.Node.prototype.toObject.call(this);c.children=[];for(var a=this.getChildren(),d=a.length,b=0;b<d;b++)c.children.push(a[b].toObject());
return c},_getDescendants:function(c){for(var a=[],d=c.length,b=0;b<d;b++){var e=c[b];this.isAncestorOf(e)&&a.push(e)}return a},isAncestorOf:function(c){for(c=c.getParent();c;){if(c._id===this._id)return!0;c=c.getParent()}return!1},clone:function(c){var a=Kinetic.Node.prototype.clone.call(this,c);this.getChildren().each(function(d){a.add(d.clone())});return a},getAllIntersections:function(c){var a=[];this.find("Shape").each(function(d){d.isVisible()&&d.intersects(c)&&a.push(d)});return a},_setChildrenIndices:function(){this.children.each(function(c,
a){c.index=a})},drawScene:function(c){var a=this.getLayer(),a=(c=c||a&&a.getCanvas())&&c.getContext(),d=this._cache.canvas,d=d&&d.scene;this.isVisible()&&(d?this._drawCachedSceneCanvas(a):this._drawChildren(c,"drawScene"));return this},drawHit:function(c){var a=this.getLayer(),a=(c=c||a&&a.hitCanvas)&&c.getContext(),d=this._cache.canvas,d=d&&d.hit;this.shouldDrawHit()&&(d?this._drawCachedHitCanvas(a):this._drawChildren(c,"drawHit"));return this},_drawChildren:function(c,a){var d=c&&c.getContext(),
b=this.getClipWidth(),e=this.getClipHeight(),f=b&&e,l,g;f&&(l=this.getClipX(),g=this.getClipY(),d.save(),d._applyTransform(this),d.beginPath(),d.rect(l,g,b,e),d.clip(),d.reset());this.children.each(function(e){e[a](c)});f&&d.restore()}});Kinetic.Util.extend(Kinetic.Container,Kinetic.Node);Kinetic.Container.prototype.get=Kinetic.Container.prototype.find;Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipX");
Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth");Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight");Kinetic.Collection.mapMethods(Kinetic.Container)})();
(function(){function c(a){a.fill()}function a(a){a.stroke()}function d(a){a.fill()}function b(a){a.stroke()}function e(){this._clearCache(f)}var f="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(f){this.nodeType="Shape";this._fillFunc=c;this._strokeFunc=a;this._fillFuncHit=d;this._strokeFuncHit=b;for(var g=Kinetic.shapes,h;!(h=Kinetic.Util.getRandomColor())||h in g;);this.colorKey=h;g[h]=this;Kinetic.Node.call(this,f);this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChanged.kinetic",
e)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(f,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||
this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},intersects:function(a){var e=this.getStage().bufferHitCanvas;e.getContext().clear();this.drawScene(e);return 0<e.context.getImageData(a.x|0,a.y|0,1,1).data[3]},destroy:function(){Kinetic.Node.prototype.destroy.call(this);delete Kinetic.shapes[this.colorKey]},
_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()},drawScene:function(a){a=(a||this.getLayer().getCanvas()).getContext();var e=this._cache.canvas,b=this.sceneFunc(),d=this.hasShadow(),c;this.isVisible()&&(e?this._drawCachedSceneCanvas(a):b&&(a.save(),this._useBufferCanvas()?(e=this.getStage(),e=e.bufferCanvas,c=e.getContext(),c.clear(),c.save(),c._applyLineJoin(this),c._applyTransform(this),b.call(this,c),c.restore(),d&&(a.save(),
a._applyShadow(this),a.drawImage(e._canvas,0,0),a.restore()),a._applyOpacity(this),a.drawImage(e._canvas,0,0)):(a._applyLineJoin(this),a._applyTransform(this),d&&(a.save(),a._applyShadow(this),b.call(this,a),a.restore()),a._applyOpacity(this),b.call(this,a)),a.restore()));return this},drawHit:function(a){a=(a||this.getLayer().hitCanvas).getContext();var e=this.hitFunc()||this.sceneFunc(),b=this._cache.canvas,b=b&&b.hit;this.shouldDrawHit()&&(b?this._drawCachedHitCanvas(a):e&&(a.save(),a._applyLineJoin(this),
a._applyTransform(this),e.call(this,a),a.restore()));return this},drawHitFromCache:function(a){a=a||0;var e=this._cache.canvas,b=this._getCachedSceneCanvas(),d=b.getContext(),e=e.hit.getContext(),c=b.getWidth(),b=b.getHeight(),f,r,n,q,s,u,w,z;e.clear();try{f=d.getImageData(0,0,c,b);r=f.data;n=e.getImageData(0,0,c,b);q=n.data;s=r.length;u=Kinetic.Util._hexToRgb(this.colorKey);for(w=0;w<s;w+=4)z=r[w+3],z>a&&(q[w]=u.r,q[w+1]=u.g,q[w+2]=u.b,q[w+3]=255);e.putImageData(n,0,0)}catch(v){Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+
v.message)}return this}});Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent);
Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowColor");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent);
Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"shadowOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillAlpha",1,Kinetic.Validators.alphaComponent);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops");Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillPatternRepeat","repeat");Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",
["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleY",1);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillLinearGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,
"fillRadialGradientStartPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointY",0);Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0);Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:"dash",getDashArray:"getDash",
setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});Kinetic.Collection.mapMethods(Kinetic.Shape)})();
(function(){function c(e,b){e.content.addEventListener(b,function(d){e[a+b](d)},!1)}var a="_",d="mousedown mousemove mouseup mouseout touchstart touchmove touchend mouseover".split(" "),b=d.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(a){this.nodeType="Stage";Kinetic.Container.call(this,a);this._id=Kinetic.idCounter++;this._buildDOM();this._bindContentEvents();this._enableNestedTransforms=!1;Kinetic.stages.push(this)},_validateAdd:function(a){"Layer"!==a.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},
setContainer:function(a){"string"===typeof a&&(a=document.getElementById(a));this._setAttr("container",a);return this},shouldDrawHit:function(){return!0},draw:function(){Kinetic.Node.prototype.draw.call(this);return this},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a);this._resizeDOM();return this},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a);this._resizeDOM();return this},clear:function(){var a=this.children,b=a.length,d;for(d=0;d<b;d++)a[d].clear();return this},
destroy:function(){var a=this.content;Kinetic.Container.prototype.destroy.call(this);a&&Kinetic.Util._isInDocument(a)&&this.getContainer().removeChild(a)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(a){function b(h){var k=r[h].toDataURL(),s=new Image;s.onload=function(){p.drawImage(s,0,0);h<r.length-1?b(h+1):a.callback(m.toDataURL(d,c))};s.src=k}a=a||{};var d=a.mimeType||null,c=a.quality||null,
h=a.x||0,k=a.y||0,m=new Kinetic.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1}),p=m.getContext()._context,r=this.children;(h||k)&&p.translate(-1*h,-1*k);b(0)},toImage:function(a){var b=a.callback;a.callback=function(a){Kinetic.Util._getImage(a,function(a){b(a)})};this.toDataURL(a)},getIntersection:function(a){var b=this.getChildren(),d,c;for(d=b.length-1;0<=d;d--)if(c=b[d].getIntersection(a))return c;return null},_resizeDOM:function(){if(this.content){var a=
this.getWidth(),b=this.getHeight(),d=this.getChildren(),c=d.length,h,k;this.content.style.width=a+"px";this.content.style.height=b+"px";this.bufferCanvas.setSize(a,b);this.bufferHitCanvas.setSize(a,b);for(h=0;h<c;h++)k=d[h],k.getCanvas().setSize(a,b),k.hitCanvas.setSize(a,b),k.draw()}},add:function(a){Kinetic.Container.prototype.add.call(this,a);a.canvas.setSize(this.attrs.width,this.attrs.height);a.hitCanvas.setSize(this.attrs.width,this.attrs.height);a.draw();this.content.appendChild(a.canvas._canvas);
return this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){var a;for(a=0;a<b;a++)c(this,d[a])},_mouseover:function(a){this._fire("contentMouseover",a)},_mouseout:function(a){this._setPointerPosition(a);var b=this.targetShape;b&&!Kinetic.isDragging()&&(b._fireAndBubble("mouseout",a),b._fireAndBubble("mouseleave",a),this.targetShape=null);this.pointerPos=void 0;this._fire("contentMouseout",a)},_mousemove:function(a){this._setPointerPosition(a);
var b=Kinetic.DD,d=this.getIntersection(this.getPointerPosition());d&&d.isListening()?Kinetic.isDragging()||this.targetShape&&this.targetShape._id===d._id?d._fireAndBubble("mousemove",a):(this.targetShape&&(this.targetShape._fireAndBubble("mouseout",a,d),this.targetShape._fireAndBubble("mouseleave",a,d)),d._fireAndBubble("mouseover",a,this.targetShape),d._fireAndBubble("mouseenter",a,this.targetShape),this.targetShape=d):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble("mouseout",
a),this.targetShape._fireAndBubble("mouseleave",a),this.targetShape=null);this._fire("contentMousemove",a);b&&b._drag(a);a.preventDefault&&a.preventDefault()},_mousedown:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0;b&&b.isListening()&&(this.clickStartShape=b,b._fireAndBubble("mousedown",a));this._fire("contentMousedown",a);a.preventDefault&&a.preventDefault()},_mouseup:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),
d=this.clickStartShape,c=!1;Kinetic.inDblClickWindow?(c=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0;setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow);b&&b.isListening()&&(b._fireAndBubble("mouseup",a),Kinetic.listenClickTap&&d&&d._id===b._id&&(b._fireAndBubble("click",a),c&&b._fireAndBubble("dblclick",a)));this._fire("contentMouseup",a);Kinetic.listenClickTap&&(this._fire("contentClick",a),c&&this._fire("contentDblclick",a));Kinetic.listenClickTap=!1;a.preventDefault&&
a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0;b&&b.isListening()&&(this.tapStartShape=b,b._fireAndBubble("touchstart",a),b.isListening()&&a.preventDefault&&a.preventDefault());this._fire("contentTouchstart",a)},_touchend:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());fireDblClick=!1;Kinetic.inDblClickWindow?(fireDblClick=!0,Kinetic.inDblClickWindow=
!1):Kinetic.inDblClickWindow=!0;setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow);b&&b.isListening()&&(b._fireAndBubble("touchend",a),Kinetic.listenClickTap&&b._id===this.tapStartShape._id&&(b._fireAndBubble("tap",a),fireDblClick&&b._fireAndBubble("dbltap",a)),b.isListening()&&a.preventDefault&&a.preventDefault());Kinetic.listenClickTap&&(this._fire("contentTouchend",a),fireDblClick&&this._fire("contentDbltap",a));Kinetic.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);
var b=Kinetic.DD,d=this.getIntersection(this.getPointerPosition());d&&d.isListening()&&(d._fireAndBubble("touchmove",a),d.isListening()&&a.preventDefault&&a.preventDefault());this._fire("contentTouchmove",a);b&&b._drag(a)},_setPointerPosition:function(a){a=a?a:window.event;var b=this._getContentPosition(),d=a.offsetX,c=a.clientX,h=null,k=null;void 0!==a.touches?1===a.touches.length&&(a=a.touches[0],h=a.clientX-b.left,k=a.clientY-b.top):void 0!==d?(h=d,k=a.offsetY):"mozilla"===Kinetic.UA.browser?(h=
a.layerX,k=a.layerY):void 0!==c&&b&&(h=c-b.left,k=a.clientY-b.top);null!==h&&null!==k&&(this.pointerPos={x:h,y:k})},_getContentPosition:function(){var a=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();a.innerHTML="";this.content=document.createElement("div");this.content.style.position="relative";this.content.style.display="inline-block";this.content.className="kineticjs-content";this.content.setAttribute("role",
"presentation");a.appendChild(this.content);this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1});this.bufferHitCanvas=new Kinetic.HitCanvas;this._resizeDOM()},_onContent:function(a,b){var d=a.split(" "),c=d.length,h,k;for(h=0;h<c;h++)k=d[h],this.content.addEventListener(k,b,!1)}});Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container);Kinetic.Factory.addGetter(Kinetic.Stage,"container");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")})();
(function(){var c=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],a=c.length;Kinetic.Util.addMethods(Kinetic.Layer,{___init:function(a){this.nodeType="Layer";this.canvas=new Kinetic.SceneCanvas;this.hitCanvas=new Kinetic.HitCanvas;Kinetic.Container.call(this,a)},_validateAdd:function(a){a=a.getType();"Group"!==a&&"Shape"!==a&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(d){var b,e,f;if(this.isVisible())for(e=
0;e<a;e++){b=c[e];b=this._getIntersection({x:d.x+b.x,y:d.y+b.y});if(f=b.shape)return f;if(!b.antialiased)return null}else return null},_getIntersection:function(a){a=this.hitCanvas.context._context.getImageData(a.x,a.y,1,1).data;var b=a[3];return 255===b?(a=Kinetic.Util._rgbToHex(a[0],a[1],a[2]),a=Kinetic.shapes["#"+a],{shape:a}):0<b?{antialiased:!0}:{}},drawScene:function(a){var b=this.getLayer();a=a||b&&b.getCanvas();this._fire("beforeDraw",{node:this});this.getClearBeforeDraw()&&a.getContext().clear();
Kinetic.Container.prototype.drawScene.call(this,a);this._fire("draw",{node:this});return this},drawHit:function(a){var b=this.getLayer();a=a||b&&b.hitCanvas;b&&b.getClearBeforeDraw()&&b.getHitCanvas().getContext().clear();Kinetic.Container.prototype.drawHit.call(this,a);return this},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(a){var b=this.getContext(),c=this.getHitCanvas().getContext();
b.clear(a);c.clear(a);return this},setVisible:function(a){Kinetic.Node.prototype.setVisible.call(this,a);a?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none");return this},setZIndex:function(a){Kinetic.Node.prototype.setZIndex.call(this,a);var b=this.getStage();b&&(b.content.removeChild(this.getCanvas()._canvas),a<b.getChildren().length-1?b.content.insertBefore(this.getCanvas()._canvas,
b.getChildren()[a+1].getCanvas()._canvas):b.content.appendChild(this.getCanvas()._canvas));return this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),a.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),this.index<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,
a.getChildren()[this.index+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas);a.content.insertBefore(this.getCanvas()._canvas,b[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas);
a.content.insertBefore(this.getCanvas()._canvas,b[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var a=this.getStage(),b=this.getCanvas()._canvas;Kinetic.Node.prototype.remove.call(this);a&&b&&Kinetic.Util._isInDocument(b)&&a.content.removeChild(b);return this},getStage:function(){return this.parent},enableHitGraph:function(){this.setHitGraphEnabled(!0);return this},disableHitGraph:function(){this.setHitGraphEnabled(!1);return this}});Kinetic.Util.extend(Kinetic.Layer,
Kinetic.Container);Kinetic.Factory.addGetterSetter(Kinetic.Layer,"clearBeforeDraw",!0);Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",!0);Kinetic.Collection.mapMethods(Kinetic.Layer)})();
(function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(c){this.nodeType="Group";Kinetic.Container.call(this,c)},_validateAdd:function(c){c=c.getType();"Group"!==c&&"Shape"!==c&&Kinetic.Util.error("You may only add groups and shapes to groups.")}});Kinetic.Util.extend(Kinetic.Group,Kinetic.Container);Kinetic.Collection.mapMethods(Kinetic.Group)})();
(function(){Kinetic.Rect=function(c){this.___init(c)};Kinetic.Rect.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Rect";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=this.getCornerRadius(),d=this.getWidth(),b=this.getHeight();c.beginPath();a?(c.moveTo(a,0),c.lineTo(d-a,0),c.arc(d-a,a,a,3*Math.PI/2,0,!1),c.lineTo(d,b-a),c.arc(d-a,b-a,a,0,Math.PI/2,!1),c.lineTo(a,b),c.arc(a,b-a,a,Math.PI/2,Math.PI,!1),c.lineTo(0,a),c.arc(a,a,a,Math.PI,3*Math.PI/2,!1)):c.rect(0,
0,d,b);c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Rect)})();
(function(){var c=2*Math.PI-1E-4;Kinetic.Circle=function(a){this.___init(a)};Kinetic.Circle.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Circle";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath();a.arc(0,0,this.getRadius(),0,c,!1);a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a);this.setRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,
a);this.setRadius(a/2)}};Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0);Kinetic.Collection.mapMethods(Kinetic.Circle)})();
(function(){var c=2*Math.PI-1E-4;Kinetic.Ellipse=function(a){this.___init(a)};Kinetic.Ellipse.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Ellipse";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var d=this.getRadius(),b=d.x,d=d.y;a.beginPath();a.save();b!==d&&a.scale(1,d/b);a.arc(0,0,b,0,c,!1);a.restore();a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,
a);this.setRadius({x:a/2})},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a);this.setRadius({y:a/2})}};Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape);Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,"radius",["x","y"]);Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusX",0);Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusY",0);Kinetic.Collection.mapMethods(Kinetic.Ellipse)})();
(function(){var c=2*Math.PI-1E-4;Kinetic.Ring=function(a){this.___init(a)};Kinetic.Ring.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Ring";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath();a.arc(0,0,this.getInnerRadius(),0,c,!1);a.moveTo(this.getOuterRadius(),0);a.arc(0,0,this.getOuterRadius(),c,0,!0);a.closePath();a.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,
a);this.setOuterRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a);this.setOuterRadius(a/2)}};Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Ring,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Ring,"outerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Ring)})();
(function(){Kinetic.Wedge=function(c){this.___init(c)};Kinetic.Wedge.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Wedge";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){c.beginPath();c.arc(0,0,this.getRadius(),0,this.getAngle()*Math.PI/180,this.getClockwise());c.lineTo(0,0);c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,
"angle",0);Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1);Kinetic.Factory.backCompat(Kinetic.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});Kinetic.Collection.mapMethods(Kinetic.Wedge)})();
(function(){Kinetic.Arc=function(c){this.___init(c)};Kinetic.Arc.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Arc";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=this.angle()*Math.PI/180,d=this.clockwise();c.beginPath();c.arc(0,0,this.getOuterRadius(),0,a,d);c.arc(0,0,this.getInnerRadius(),a,0,!d);c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,
"outerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"angle",0);Kinetic.Factory.addGetterSetter(Kinetic.Arc,"clockwise",!1);Kinetic.Collection.mapMethods(Kinetic.Arc)})();
(function(){Kinetic.Image=function(c){this.___init(c)};Kinetic.Image.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Image";this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_sceneFunc:function(c){var a=this.getWidth(),d=this.getHeight(),b=this.getImage(),e,f,l;b&&(e=this.getCrop(),f=e.width,l=e.height,e=f&&l?[b,e.x,e.y,f,l,0,0,a,d]:[b,0,0,a,d]);c.beginPath();
c.rect(0,0,a,d);c.closePath();c.fillStrokeShape(this);b&&c.drawImage.apply(c,e)},_hitFunc:function(c){var a=this.getWidth(),d=this.getHeight();c.beginPath();c.rect(0,0,a,d);c.closePath();c.fillStrokeShape(this)},getWidth:function(){var c=this.getImage();return this.attrs.width||(c?c.width:0)},getHeight:function(){var c=this.getImage();return this.attrs.height||(c?c.height:0)}};Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Image,"image");Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,
"crop",["x","y","width","height"]);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0);Kinetic.Collection.mapMethods(Kinetic.Image)})();
(function(){function c(a){a.fillText(this.partialText,0,0)}function a(a){a.strokeText(this.partialText,0,0)}var d="fontFamily fontSize fontStyle padding align lineHeight text width height wrap".split(" "),b=d.length,e=document.createElement("canvas").getContext("2d");Kinetic.Text=function(a){this.___init(a)};Kinetic.Text.prototype={___init:function(e){void 0===e.width&&(e.width="auto");void 0===e.height&&(e.height="auto");Kinetic.Shape.call(this,e);this._fillFunc=c;this._strokeFunc=a;this.className=
"Text";for(e=0;e<b;e++)this.on(d[e]+"Change.kinetic",this._setTextData);this._setTextData();this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var b=this.getPadding(),d=this.getTextHeight(),c=this.getLineHeight()*d,e=this.textArr,m=e.length,p=this.getWidth();a.setAttr("font",this._getContextFont());a.setAttr("textBaseline","middle");a.setAttr("textAlign","left");a.save();a.translate(b,0);a.translate(0,b+d/2);for(d=0;d<m;d++){var r=e[d],n=r.text,r=r.width;a.save();
"right"===this.getAlign()?a.translate(p-r-2*b,0):"center"===this.getAlign()&&a.translate((p-r-2*b)/2,0);this.partialText=n;a.fillStrokeShape(this);a.restore();a.translate(0,c)}a.restore()},_hitFunc:function(a){var b=this.getWidth(),d=this.getHeight();a.beginPath();a.rect(0,0,b,d);a.closePath();a.fillStrokeShape(this)},setText:function(a){a=Kinetic.Util._isString(a)?a:a.toString();this._setAttr("text",a);return this},getWidth:function(){return"auto"===this.attrs.width?this.getTextWidth()+2*this.getPadding():
this.attrs.width},getHeight:function(){return"auto"===this.attrs.height?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var b=this.getFontSize();e.save();e.font=this._getContextFont();a=e.measureText(a);e.restore();return{width:a.width,height:parseInt(b,10)}},_getContextFont:function(){return this.getFontStyle()+" "+this.getFontSize()+
"px "+this.getFontFamily()},_addTextLine:function(a,b){return this.textArr.push({text:a,width:b})},_getTextWidth:function(a){return e.measureText(a).width},_setTextData:function(){var a=this.getText().split("\n"),b=+this.getFontSize(),d=0,c=this.getLineHeight()*b,k=this.attrs.width,m=this.attrs.height,p="auto"!==k,r="auto"!==m,n=this.getPadding(),k=k-2*n,m=m-2*n,n=0,q=this.getWrap(),s="none"!==q,q="char"!==q&&s;this.textArr=[];e.save();e.font=this.getFontStyle()+" "+b+"px "+this.getFontFamily();for(var u=
0,w=a.length;u<w;++u){var z=a[u],v=this._getTextWidth(z);if(p&&v>k)for(;0<z.length;){for(var v=0,x=z.length,y="",G=0;v<x;){var A=v+x>>>1,E=z.slice(0,A+1),I=this._getTextWidth(E);I<=k?(v=A+1,y=E,G=I):x=A}if(y){q&&(x=Math.max(y.lastIndexOf(" "),y.lastIndexOf("-"))+1,0<x&&(v=x,y=y.slice(0,v),G=this._getTextWidth(y)));this._addTextLine(y,G);n+=c;if(!s||r&&n+c>m)break;z=z.slice(v);if(0<z.length&&(v=this._getTextWidth(z),v<=k)){this._addTextLine(z,v);n+=c;break}}else break}else this._addTextLine(z,v),n+=
c,d=Math.max(d,v);if(r&&n+c>m)break}e.restore();this.textHeight=b;this.textWidth=d}};Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial");Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle","normal");Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0);Kinetic.Factory.addGetterSetter(Kinetic.Text,"align","left");Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",
1);Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap","word");Kinetic.Factory.addGetter(Kinetic.Text,"text","");Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text");Kinetic.Collection.mapMethods(Kinetic.Text)})();
(function(){Kinetic.Line=function(c){this.___init(c)};Kinetic.Line.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Line";this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=this.getPoints(),d=a.length,b=this.getTension(),e=this.getClosed(),f,l;c.beginPath();c.moveTo(a[0],a[1]);if(0!==b&&4<d){b=this.getTensionPoints();f=b.length;l=e?0:4;for(e||
c.quadraticCurveTo(b[0],b[1],b[2],b[3]);l<f-2;)c.bezierCurveTo(b[l++],b[l++],b[l++],b[l++],b[l++],b[l++]);e||c.quadraticCurveTo(b[f-2],b[f-1],a[d-2],a[d-1])}else for(l=2;l<d;l+=2)c.lineTo(a[l],a[l+1]);e?(c.closePath(),c.fillStrokeShape(this)):c.strokeShape(this)},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():Kinetic.Util._expandPoints(this.getPoints(),this.getTension())},
_getTensionPointsClosed:function(){var c=this.getPoints(),a=c.length,d=this.getTension(),b=Kinetic.Util,e=b._getControlPoints(c[a-2],c[a-1],c[0],c[1],c[2],c[3],d),b=b._getControlPoints(c[a-4],c[a-3],c[a-2],c[a-1],c[0],c[1],d),d=Kinetic.Util._expandPoints(c,d);return[e[2],e[3]].concat(d).concat([b[0],b[1],c[a-2],c[a-1],b[2],b[3],e[0],e[1],c[0],c[1]])}};Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Line,"closed",!1);Kinetic.Factory.addGetterSetter(Kinetic.Line,
"tension",0);Kinetic.Factory.addGetterSetter(Kinetic.Line,"points");Kinetic.Collection.mapMethods(Kinetic.Line)})();
(function(){Kinetic.Sprite=function(c){this.___init(c)};Kinetic.Sprite.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Sprite";this.anim=new Kinetic.Animation;this.on("animationChange.kinetic",function(){this.frameIndex(0)});this.sceneFunc(this._sceneFunc);this.hitFunc(this._hitFunc)},_sceneFunc:function(c){var a=this.getAnimation(),d=4*this.frameIndex(),b=this.getAnimations()[a],a=b[d+0],e=b[d+1],f=b[d+2],d=b[d+3];(b=this.getImage())&&c.drawImage(b,a,e,f,d,0,0,f,d)},_hitFunc:function(c){var a=
this.getAnimation(),d=4*this.frameIndex(),b=this.getAnimations()[a],a=b[d+2],d=b[d+3];c.beginPath();c.rect(0,0,a,d);c.closePath();c.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},start:function(){var c=this,a=this.getLayer();this.anim.setLayers(a);this.interval=setInterval(function(){c._updateIndex()},1E3/this.getFrameRate());this.anim.start()},stop:function(){this.anim.stop();clearInterval(this.interval)},_updateIndex:function(){var c=
this.frameIndex(),a=this.getAnimation(),a=this.getAnimations()[a].length/4;c<a-1?this.frameIndex(c+1):this.frameIndex(0)}};Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image");Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameIndex",0);Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17);Kinetic.Factory.backCompat(Kinetic.Sprite,
{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});Kinetic.Collection.mapMethods(Kinetic.Sprite)})();
(function(){Kinetic.Path=function(c){this.___init(c)};Kinetic.Path.prototype={___init:function(c){this.dataArray=[];var a=this;Kinetic.Shape.call(this,c);this.className="Path";this.dataArray=Kinetic.Path.parsePathData(this.getData());this.on("dataChange.kinetic",function(){a.dataArray=Kinetic.Path.parsePathData(this.getData())});this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=this.dataArray,d=!1;c.beginPath();for(var b=0;b<a.length;b++){var e=a[b].points;switch(a[b].command){case "L":c.lineTo(e[0],
e[1]);break;case "M":c.moveTo(e[0],e[1]);break;case "C":c.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case "Q":c.quadraticCurveTo(e[0],e[1],e[2],e[3]);break;case "A":var f=e[0],l=e[1],g=e[2],h=e[3],k=e[4],m=e[5],p=e[6],e=e[7],r=g>h?g:h,n=g>h?1:g/h,g=g>h?h/g:1;c.translate(f,l);c.rotate(p);c.scale(n,g);c.arc(0,0,r,k,k+m,1-e);c.scale(1/n,1/g);c.rotate(-p);c.translate(-f,-l);break;case "z":c.closePath(),d=!0}}d?c.fillStrokeShape(this):c.strokeShape(this)}};Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape);
Kinetic.Path.getLineLength=function(c,a,d,b){return Math.sqrt((d-c)*(d-c)+(b-a)*(b-a))};Kinetic.Path.getPointOnLine=function(c,a,d,b,e,f,l){void 0===f&&(f=a);void 0===l&&(l=d);var g=(e-d)/(b-a+1E-8),h=Math.sqrt(c*c/(1+g*g));b<a&&(h*=-1);var k=g*h;if(b===a)a={x:f,y:l+k};else if((l-d)/(f-a+1E-8)===g)a={x:f+h,y:l+k};else{k=this.getLineLength(a,d,b,e);if(1E-8>k)return;h=((f-a)*(b-a)+(l-d)*(e-d))/(k*k);k=a+h*(b-a);d+=h*(e-d);f=this.getLineLength(f,l,k,d);c=Math.sqrt(c*c-f*f);h=Math.sqrt(c*c/(1+g*g));b<
a&&(h*=-1);a={x:k+h,y:d+g*h}}return a};Kinetic.Path.getPointOnCubicBezier=function(c,a,d,b,e,f,l,g,h){return{x:g*c*c*c+3*f*c*c*(1-c)+3*b*c*(1-c)*(1-c)+a*(1-c)*(1-c)*(1-c),y:h*c*c*c+3*l*c*c*(1-c)+3*e*c*(1-c)*(1-c)+d*(1-c)*(1-c)*(1-c)}};Kinetic.Path.getPointOnQuadraticBezier=function(c,a,d,b,e,f,l){return{x:f*c*c+2*b*c*(1-c)+a*(1-c)*(1-c),y:l*c*c+2*e*c*(1-c)+d*(1-c)*(1-c)}};Kinetic.Path.getPointOnEllipticalArc=function(c,a,d,b,e,f){var l=Math.cos(f);f=Math.sin(f);d*=Math.cos(e);b*=Math.sin(e);return{x:c+
(d*l-b*f),y:a+(d*f+b*l)}};Kinetic.Path.parsePathData=function(c){if(!c)return[];var a,d="mMlLvVhHzZcCqQtTsSaA".split("");a=c.replace(/ /g,",");for(c=0;c<d.length;c++)a=a.replace(RegExp(d[c],"g"),"|"+d[c]);d=a.split("|");a=[];var b=0,e=0;for(c=1;c<d.length;c++){var f=d[c],l=f.charAt(0),f=f.slice(1),f=f.replace(/,-/g,"-"),f=f.replace(/-/g,",-"),f=f.replace(/e,-/g,"e-"),f=f.split(",");0<f.length&&""===f[0]&&f.shift();for(var g=0;g<f.length;g++)f[g]=parseFloat(f[g]);for(;0<f.length&&!isNaN(f[0]);){var h=
null,k=[],g=b,m=e,p,r,n,q,s,u;switch(l){case "l":b+=f.shift();e+=f.shift();h="L";k.push(b,e);break;case "L":b=f.shift();e=f.shift();k.push(b,e);break;case "m":l=f.shift();p=f.shift();b+=l;e+=p;h="M";if(2<a.length&&"z"===a[a.length-1].command)for(r=a.length-2;0<=r;r--)if("M"===a[r].command){b=a[r].points[0]+l;e=a[r].points[1]+p;break}k.push(b,e);l="l";break;case "M":b=f.shift();e=f.shift();h="M";k.push(b,e);l="L";break;case "h":b+=f.shift();h="L";k.push(b,e);break;case "H":b=f.shift();h="L";k.push(b,
e);break;case "v":e+=f.shift();h="L";k.push(b,e);break;case "V":e=f.shift();h="L";k.push(b,e);break;case "C":k.push(f.shift(),f.shift(),f.shift(),f.shift());b=f.shift();e=f.shift();k.push(b,e);break;case "c":k.push(b+f.shift(),e+f.shift(),b+f.shift(),e+f.shift());b+=f.shift();e+=f.shift();h="C";k.push(b,e);break;case "S":p=b;r=e;h=a[a.length-1];"C"===h.command&&(p=b+(b-h.points[2]),r=e+(e-h.points[3]));k.push(p,r,f.shift(),f.shift());b=f.shift();e=f.shift();h="C";k.push(b,e);break;case "s":p=b;r=
e;h=a[a.length-1];"C"===h.command&&(p=b+(b-h.points[2]),r=e+(e-h.points[3]));k.push(p,r,b+f.shift(),e+f.shift());b+=f.shift();e+=f.shift();h="C";k.push(b,e);break;case "Q":k.push(f.shift(),f.shift());b=f.shift();e=f.shift();k.push(b,e);break;case "q":k.push(b+f.shift(),e+f.shift());b+=f.shift();e+=f.shift();h="Q";k.push(b,e);break;case "T":p=b;r=e;h=a[a.length-1];"Q"===h.command&&(p=b+(b-h.points[0]),r=e+(e-h.points[1]));b=f.shift();e=f.shift();h="Q";k.push(p,r,b,e);break;case "t":p=b;r=e;h=a[a.length-
1];"Q"===h.command&&(p=b+(b-h.points[0]),r=e+(e-h.points[1]));b+=f.shift();e+=f.shift();h="Q";k.push(p,r,b,e);break;case "A":k=f.shift();p=f.shift();r=f.shift();n=f.shift();q=f.shift();s=b;u=e;b=f.shift();e=f.shift();h="A";k=this.convertEndpointToCenterParameterization(s,u,b,e,n,q,k,p,r);break;case "a":k=f.shift(),p=f.shift(),r=f.shift(),n=f.shift(),q=f.shift(),s=b,u=e,b+=f.shift(),e+=f.shift(),h="A",k=this.convertEndpointToCenterParameterization(s,u,b,e,n,q,k,p,r)}a.push({command:h||l,points:k,start:{x:g,
y:m},pathLength:this.calcLength(g,m,h||l,k)})}"z"!==l&&"Z"!==l||a.push({command:"z",points:[],start:void 0,pathLength:0})}return a};Kinetic.Path.calcLength=function(c,a,d,b){var e,f,l=Kinetic.Path;switch(d){case "L":return l.getLineLength(c,a,b[0],b[1]);case "C":d=0;e=l.getPointOnCubicBezier(0,c,a,b[0],b[1],b[2],b[3],b[4],b[5]);for(t=0.01;1>=t;t+=0.01)f=l.getPointOnCubicBezier(t,c,a,b[0],b[1],b[2],b[3],b[4],b[5]),d+=l.getLineLength(e.x,e.y,f.x,f.y),e=f;return d;case "Q":d=0;e=l.getPointOnQuadraticBezier(0,
c,a,b[0],b[1],b[2],b[3]);for(t=0.01;1>=t;t+=0.01)f=l.getPointOnQuadraticBezier(t,c,a,b[0],b[1],b[2],b[3]),d+=l.getLineLength(e.x,e.y,f.x,f.y),e=f;return d;case "A":d=0;f=b[4];var g=b[5];c=b[4]+g;a=Math.PI/180;Math.abs(f-c)<a&&(a=Math.abs(f-c));e=l.getPointOnEllipticalArc(b[0],b[1],b[2],b[3],f,0);if(0>g)for(t=f-a;t>c;t-=a)f=l.getPointOnEllipticalArc(b[0],b[1],b[2],b[3],t,0),d+=l.getLineLength(e.x,e.y,f.x,f.y),e=f;else for(t=f+a;t<c;t+=a)f=l.getPointOnEllipticalArc(b[0],b[1],b[2],b[3],t,0),d+=l.getLineLength(e.x,
e.y,f.x,f.y),e=f;f=l.getPointOnEllipticalArc(b[0],b[1],b[2],b[3],c,0);return d+=l.getLineLength(e.x,e.y,f.x,f.y)}return 0};Kinetic.Path.convertEndpointToCenterParameterization=function(c,a,d,b,e,f,l,g,h){h*=Math.PI/180;var k=Math.cos(h)*(c-d)/2+Math.sin(h)*(a-b)/2,m=-1*Math.sin(h)*(c-d)/2+Math.cos(h)*(a-b)/2,p=k*k/(l*l)+m*m/(g*g);1<p&&(l*=Math.sqrt(p),g*=Math.sqrt(p));p=Math.sqrt((l*l*g*g-l*l*m*m-g*g*k*k)/(l*l*m*m+g*g*k*k));e==f&&(p*=-1);isNaN(p)&&(p=0);e=p*l*m/g;p=p*-g*k/l;c=(c+d)/2+Math.cos(h)*
e-Math.sin(h)*p;a=(a+b)/2+Math.sin(h)*e+Math.cos(h)*p;var r=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(a[0]*a[0]+a[1]*a[1])*Math.sqrt(b[0]*b[0]+b[1]*b[1]))},n=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(r(a,b))};b=n([1,0],[(k-e)/l,(m-p)/g]);d=[(k-e)/l,(m-p)/g];k=[(-1*k-e)/l,(-1*m-p)/g];m=n(d,k);-1>=r(d,k)&&(m=Math.PI);1<=r(d,k)&&(m=0);0===f&&0<m&&(m-=2*Math.PI);1==f&&0>m&&(m+=2*Math.PI);return[c,a,l,g,b,m,h,f]};Kinetic.Factory.addGetterSetter(Kinetic.Path,"data");Kinetic.Collection.mapMethods(Kinetic.Path)})();
(function(){function c(a){a.fillText(this.partialText,0,0)}function a(a){a.strokeText(this.partialText,0,0)}Kinetic.TextPath=function(a){this.___init(a)};Kinetic.TextPath.prototype={___init:function(d){var b=this;this.dummyCanvas=document.createElement("canvas");this.dataArray=[];Kinetic.Shape.call(this,d);this._fillFunc=c;this._strokeFunc=a;this._fillFuncHit=c;this._strokeFuncHit=a;this.className="TextPath";this.dataArray=Kinetic.Path.parsePathData(this.attrs.data);this.on("dataChange.kinetic",function(){b.dataArray=
Kinetic.Path.parsePathData(this.attrs.data)});this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",b._setTextData);b._setTextData();this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.setAttr("font",this._getContextFont());a.setAttr("textBaseline","middle");a.setAttr("textAlign","left");a.save();for(var b=this.glyphInfo,c=0;c<b.length;c++){a.save();var f=b[c].p0;a.translate(f.x,f.y);a.rotate(b[c].rotation);this.partialText=b[c].text;a.fillStrokeShape(this);a.restore()}a.restore()},
getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(a){Kinetic.Text.prototype.setText.call(this,a)},_getTextSize:function(a){var b=this.dummyCanvas.getContext("2d");b.save();b.font=this._getContextFont();a=b.measureText(a);b.restore();return{width:a.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=this._getTextSize(this.attrs.text);this.textWidth=a.width;this.textHeight=a.height;this.glyphInfo=[];for(var a=this.attrs.text.split(""),
b,c,f,l=-1,g=0,h=0;h<a.length;h++){var k=this._getTextSize(a[h]).width,m=0,p=0;for(c=void 0;0.01<Math.abs(k-m)/k&&25>p;){p++;for(var r=m;void 0===f;){a:{g=0;f=this.dataArray;for(var n=l+1;n<f.length;n++)if(0<f[n].pathLength){l=n;f=f[n];break a}else"M"==f[n].command&&(b={x:f[n].points[0],y:f[n].points[1]});f={}}f&&r+f.pathLength<k&&(r+=f.pathLength,f=void 0)}if(f==={}||void 0===b)break;r=!1;switch(f.command){case "L":Kinetic.Path.getLineLength(b.x,b.y,f.points[0],f.points[1])>k?c=Kinetic.Path.getPointOnLine(k,
b.x,b.y,f.points[0],f.points[1],b.x,b.y):f=void 0;break;case "A":c=f.points[4];var n=f.points[5],q=f.points[4]+n,g=0===g?c+1E-8:k>m?g+Math.PI/180*n/Math.abs(n):g-Math.PI/360*n/Math.abs(n);if(0>n&&g<q||0<=n&&g>q)g=q,r=!0;c=Kinetic.Path.getPointOnEllipticalArc(f.points[0],f.points[1],f.points[2],f.points[3],g,f.points[6]);break;case "C":g=0===g?k>f.pathLength?1E-8:k/f.pathLength:k>m?g+(k-m)/f.pathLength:g-(m-k)/f.pathLength;1<g&&(g=1,r=!0);c=Kinetic.Path.getPointOnCubicBezier(g,f.start.x,f.start.y,
f.points[0],f.points[1],f.points[2],f.points[3],f.points[4],f.points[5]);break;case "Q":g=0===g?k/f.pathLength:k>m?g+(k-m)/f.pathLength:g-(m-k)/f.pathLength,1<g&&(g=1,r=!0),c=Kinetic.Path.getPointOnQuadraticBezier(g,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3])}void 0!==c&&(m=Kinetic.Path.getLineLength(b.x,b.y,c.x,c.y));r&&(f=void 0)}if(void 0===b||void 0===c)break;k=Kinetic.Path.getLineLength(b.x,b.y,c.x,c.y);k=Kinetic.Path.getPointOnLine(0+k/2,b.x,b.y,c.x,c.y);m=Math.atan2(c.y-
b.y,c.x-b.x);this.glyphInfo.push({transposeX:k.x,transposeY:k.y,text:a[h],rotation:m,p0:b,p1:c});b=c}}};Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont;Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Arial");Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12);Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle","normal");Kinetic.Factory.addGetter(Kinetic.TextPath,"text","");Kinetic.Collection.mapMethods(Kinetic.TextPath)})();
(function(){Kinetic.RegularPolygon=function(c){this.___init(c)};Kinetic.RegularPolygon.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="RegularPolygon";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=this.attrs.sides,d=this.attrs.radius,b,e,f;c.beginPath();c.moveTo(0,0-d);for(b=1;b<a;b++)e=d*Math.sin(2*b*Math.PI/a),f=-1*d*Math.cos(2*b*Math.PI/a),c.lineTo(e,f);c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,
"radius",0);Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0);Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)})();
(function(){Kinetic.Star=function(c){this.___init(c)};Kinetic.Star.prototype={___init:function(c){Kinetic.Shape.call(this,c);this.className="Star";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a=this.innerRadius(),d=this.outerRadius(),b=this.numPoints();c.beginPath();c.moveTo(0,0-d);for(var e=1;e<2*b;e++){var f=0===e%2?d:a,l=f*Math.sin(e*Math.PI/b),f=-1*f*Math.cos(e*Math.PI/b);c.lineTo(l,f)}c.closePath();c.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Star,
"numPoints",5);Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0);Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Star)})();
(function(){var c="fontFamily fontSize fontStyle padding lineHeight text".split(" "),a=c.length;Kinetic.Label=function(a){this.____init(a)};Kinetic.Label.prototype={____init:function(a){var b=this;this.className="Label";Kinetic.Group.call(this,a);this.on("add.kinetic",function(a){b._addListeners(a.child);b._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(d){var b=this,e,f=function(){b._sync()};for(e=0;e<a;e++)d.on(c[e]+
"Change.kinetic",f)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var a=this.getText(),b=this.getTag(),c,f,l,g,h,k;if(a&&b){c=a.getWidth();f=a.getHeight();l=b.getPointerDirection();g=b.getPointerWidth();pointerHeight=b.getPointerHeight();k=h=0;switch(l){case "up":h=c/2;k=-1*pointerHeight;break;case "right":h=c+g;k=f/2;break;case "down":h=c/2;k=f+pointerHeight;break;case "left":h=-1*g,k=f/2}b.setAttrs({x:-1*h,y:-1*k,
width:c,height:f});a.setAttrs({x:-1*h,y:-1*k})}}};Kinetic.Util.extend(Kinetic.Label,Kinetic.Group);Kinetic.Collection.mapMethods(Kinetic.Label);Kinetic.Tag=function(a){this.___init(a)};Kinetic.Tag.prototype={___init:function(a){Kinetic.Shape.call(this,a);this.className="Tag";this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getWidth(),c=this.getHeight(),f=this.getPointerDirection(),l=this.getPointerWidth(),g=this.getPointerHeight();this.getCornerRadius();a.beginPath();a.moveTo(0,
0);"up"===f&&(a.lineTo((b-l)/2,0),a.lineTo(b/2,-1*g),a.lineTo((b+l)/2,0));a.lineTo(b,0);"right"===f&&(a.lineTo(b,(c-g)/2),a.lineTo(b+l,c/2),a.lineTo(b,(c+g)/2));a.lineTo(b,c);"down"===f&&(a.lineTo((b+l)/2,c),a.lineTo(b/2,c+g),a.lineTo((b-l)/2,c));a.lineTo(0,c);"left"===f&&(a.lineTo(0,(c+g)/2),a.lineTo(-1*l,c/2),a.lineTo(0,(c-g)/2));a.closePath();a.fillStrokeShape(this)}};Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection","none");Kinetic.Factory.addGetterSetter(Kinetic.Tag,
"pointerWidth",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0);Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0);Kinetic.Collection.mapMethods(Kinetic.Tag)})();
